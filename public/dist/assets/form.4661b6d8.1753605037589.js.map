{"version":3,"file":"form.4661b6d8.1753605037589.js","sources":["../../src/pages/event/form.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport Api from \"@/api\"\r\nimport dayjs from \"dayjs\";\r\nimport initMap from \"@/pages/venue/mapinit\";\r\n\r\nconst router = useRouter()\r\nconst eventFormRef = ref(null)\r\nconst current = ref(0);\r\nconst opts = ref({\r\n  venues: [],\r\n  tickets: [],\r\n  coaches: [],\r\n  sport_types:[]\r\n})\r\nconst next = () => {\r\n  // 先对表单进行一次验证\r\n  eventFormRef.value.validate().then(() => {\r\n    current.value++;\r\n    if (eventForm.value.event_type === 'outdoor') {\r\n      initMapShow()\r\n    }\r\n  })\r\n};\r\nconst prev = () => {\r\n  current.value--;\r\n};\r\nconst getOpt = async () => {\r\n  opts.value = await Api.eventController.eventOption()\r\n}\r\ngetOpt()\r\n\r\nconst eventForm = ref({\r\n  code: \"\",\r\n  title: \"\",\r\n  description: \"\",\r\n\r\n  event_type: \"\",\r\n\r\n  sport_type_id: null,\r\n\r\n  format: \"\",\r\n\r\n  max_participants: \"\",\r\n  min_participants: \"\",\r\n  start_time: \"\",\r\n  end_time: \"\",\r\n\r\n  registration_deadline: \"\",\r\n\r\n  cover_image: \"\",\r\n\r\n  status: \"\",\r\n  creator_id: \"\",\r\n  creator_role: \"\",\r\n  professional_form: {\r\n    venue_id: 0,\r\n    coach_id: 0,\r\n    ticket_id: 0,\r\n    ticket_price: 0,\r\n    referee_id: 0,\r\n    equipment_provided: \"\",\r\n    rules_description: \"\"\r\n  },\r\n  outdoor_form: {\r\n    location: \"\",\r\n    gps: {\r\n      type: \"Point\",\r\n      coordinates: [107.466127, 31.224677],\r\n    },\r\n    meeting_point: \"\",\r\n    contact_person: \"\",\r\n    contact_phone: \"\",\r\n    bring_equipment: \"\",\r\n    weather_plan: \"\",\r\n  }\r\n})\r\nconst resetAssociationForm = () => {\r\n  eventForm.value.professional_form = {\r\n    venue_id: 0,\r\n    coach_id: 0,\r\n    ticket_id: 0,\r\n    ticket_price: 0,\r\n    referee_id: 0,\r\n    equipment_provided: \"\",\r\n    rules_description: \"\"\r\n  }\r\n  eventForm.value.outdoor_form = {\r\n    location: \"\",\r\n    gps: {\r\n      type: \"Point\",\r\n      coordinates: [107.466127, 31.224677],\r\n    },\r\n    meeting_point: \"\",\r\n    contact_person: \"\",\r\n    contact_phone: \"\",\r\n    bring_equipment: \"\",\r\n    weather_plan: \"\",\r\n  }\r\n}\r\nconst getData = (param) => {\r\n  eventForm.value.outdoor_form.gps.coordinates[1] = param.lat;\r\n  eventForm.value.outdoor_form.gps.coordinates[0] = param.lng;\r\n};\r\n\r\nconst initMapShow = () => {\r\n  setTimeout(() => {\r\n    initMap(getData, [\r\n      eventForm.value.outdoor_form.gps.coordinates[1],\r\n      eventForm.value.outdoor_form.gps.coordinates[0],\r\n    ]);\r\n  }, 1000);\r\n}\r\n\r\n\r\nconst steps = [\r\n  {\r\n    title: '基础信息',\r\n    content: 'First-content',\r\n  },\r\n  {\r\n    title: '赛场信息',\r\n    content: 'Second-content',\r\n  },\r\n]\r\n\r\nconst qrClick = async () => {\r\n  eventForm.value.code = await Api.qrController.makeQr()\r\n}\r\n\r\nconst onSubmit = async () => {\r\n  await Api.eventController.store(eventForm.value)\r\n  eventFormRef.value.resetFields();\r\n  resetAssociationForm();\r\n  router.go(-1)\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <div class=\"flex justify-center\">\r\n      <div class=\"w-[60%]\">\r\n        <a-steps :current=\"current\" size=\"small\">\r\n          <a-step v-for=\"item in steps\" :key=\"item.title\" :title=\"item.title\"/>\r\n        </a-steps>\r\n      </div>\r\n    </div>\r\n    <div class=\"steps-content p-3\">\r\n      <a-divider>表单</a-divider>\r\n      <a-form\r\n          ref=\"eventFormRef\"\r\n          :model=\"eventForm\"\r\n          name=\"validate_other\"\r\n      >\r\n        <a-row :gutter=\"[32,8]\" v-show=\"current===0\">\r\n\r\n          <a-col :span=\"12\">\r\n\r\n            <a-form-item\r\n                name=\"code\"\r\n                label=\"赛事编码\"\r\n                has-feedback\r\n                :rules=\"[{ required: true, message: '编码必填' }]\"\r\n            >\r\n              <a-input-group>\r\n                <a-input v-model:value=\"eventForm.code\" style=\"width: calc(100% - 200px)\"/>\r\n                <a-tooltip title=\"点击生成小程序二维码\">\r\n                  <a-button type=\"primary\" @click=\"qrClick\">\r\n                    <template #icon>\r\n                      <qrcode-outlined/>\r\n                    </template>\r\n                  </a-button>\r\n                </a-tooltip>\r\n              </a-input-group>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n            <a-form-item\r\n                name=\"title\"\r\n                label=\"标题\"\r\n                has-feedback\r\n                :rules=\"[{ required: true, message: '标题必填' }]\"\r\n            >\r\n              <a-input v-model:value=\"eventForm.title\"/>\r\n            </a-form-item>\r\n\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"类别\" name=\"event_type\" :rules=\"[{ required: true, message: '请选类别' }]\">\r\n              <a-radio-group v-model:value=\"eventForm.event_type\">\r\n                <a-radio value=\"professional\">专业</a-radio>\r\n                <a-radio value=\"outdoor\">户外</a-radio>\r\n              </a-radio-group>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n\r\n            <a-form-item name=\"sport_type_id\" label=\"运动类型\" :rules=\"[{ required: true, message: '必填' }]\">\r\n              <a-select v-model:value=\"eventForm.sport_type_id\" :options=\"opts.sport_types\">\r\n              </a-select>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n\r\n            <a-form-item name=\"format\" label=\"比赛形式\" :rules=\"[{ required: true, message: '必填' }]\">\r\n              <a-input v-model:value=\"eventForm.format\" placeholder=\"如：3v3,2v2，5v5等\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n            <a-form-item name=\"cover_image\" label=\"封面\" :rules=\"[{ required: true, message: '必填' }]\">\r\n              <a-form-item-rest>\r\n                <file-select v-model=\"eventForm.cover_image\"></file-select>\r\n              </a-form-item-rest>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n            <a-form-item name=\"max_participants\" label=\"最大参赛人数\" :rules=\"[{ required: true, message: '必填' }]\">\r\n              <a-input-number v-model:value=\"eventForm.max_participants\"/>\r\n            </a-form-item>\r\n            <a-form-item name=\"min_participants\" label=\"最小开赛人数\" :rules=\"[{ required: true, message: '必填' }]\">\r\n              <a-input-number v-model:value=\"eventForm.min_participants\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n            <a-form-item name=\"start_time\" label=\"开赛时间\" :rules=\"[{ required: true, message: '必填' }]\">\r\n              <a-date-picker\r\n                  v-model:value=\"eventForm.start_time\"\r\n                  format=\"YYYY-MM-DD HH:mm:ss\"\r\n                  :show-time=\"{ defaultValue: dayjs('00:00:00', 'HH:mm:ss') }\"\r\n              />\r\n            </a-form-item>\r\n            <a-form-item name=\"end_time\" label=\"结束时间\" :rules=\"[{ required: true, message: '必填' }]\">\r\n              <a-date-picker\r\n                  v-model:value=\"eventForm.end_time\"\r\n                  format=\"YYYY-MM-DD HH:mm:ss\"\r\n                  :show-time=\"{ defaultValue: dayjs('00:00:00', 'HH:mm:ss') }\"\r\n              />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"24\">\r\n            <a-form-item label=\"介绍\" :rules=\"[{ required: true, message: '必填' }]\">\r\n              <a-form-item name=\"description\">\r\n                <a-textarea v-model:value=\"eventForm.description\"></a-textarea>\r\n              </a-form-item>\r\n            </a-form-item>\r\n\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n            <a-form-item name=\"registration_deadline\" label=\"报名截止时间\"\r\n                         :rules=\"[{ required: true, message: '必填' }]\">\r\n              <a-date-picker\r\n                  v-model:value=\"eventForm.registration_deadline\"\r\n                  format=\"YYYY-MM-DD HH:mm:ss\"\r\n                  :show-time=\"{ defaultValue: dayjs('00:00:00', 'HH:mm:ss') }\"\r\n              />\r\n            </a-form-item>\r\n\r\n          </a-col>\r\n\r\n        </a-row>\r\n\r\n        <a-row :gutter=\"[32,8]\" v-show=\"current===1 && eventForm.event_type=='outdoor'\">\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"地址\" name=\"outdoor_form.location\">\r\n              <a-input v-model:value=\"eventForm.outdoor_form.location\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"集合地点\" name=\"outdoor_form.meeting_point\">\r\n              <a-input v-model:value=\"eventForm.outdoor_form.meeting_point\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"联系人\" name=\"outdoor_form.contact_person\">\r\n              <a-input v-model:value=\"eventForm.outdoor_form.contact_person\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"联系电话\" name=\"outdoor_form.contact_phone\">\r\n              <a-input v-model:value=\"eventForm.outdoor_form.contact_phone\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"需自带装备\" name=\"outdoor_form.bring_equipment\">\r\n              <a-input v-model:value=\"eventForm.outdoor_form.bring_equipment\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"雨天备选方案\" name=\"outdoor_form.weather_plan\">\r\n              <a-textarea v-model:value=\"eventForm.outdoor_form.weather_plan\"></a-textarea>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"24\">\r\n            <a-form-item label=\"坐标\" name=\"outdoor_form.gps\">\r\n              <a-alert :message=\"`【精度：${eventForm.outdoor_form.gps?.coordinates[0]}\r\n               纬度：${eventForm.outdoor_form.gps?.coordinates[1]}】`\" type=\"info\"/>\r\n              <div id=\"container\"></div>\r\n            </a-form-item>\r\n          </a-col>\r\n        </a-row>\r\n\r\n        <a-row :gutter=\"[32,8]\" v-if=\"current===1 && eventForm.event_type=='professional'\">\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"场馆\" name=\"professional_form.venue_id\">\r\n              <a-select v-model:value=\"eventForm.professional_form.venue_id\" :options=\"opts.venues\">\r\n              </a-select>\r\n            </a-form-item>\r\n          </a-col>\r\n          \r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"门票\" name=\"professional_form.ticket_id\">\r\n              <a-select v-model:value=\"eventForm.professional_form.ticket_id\" :options=\"opts.tickets\">\r\n              </a-select>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"裁判\" name=\"professional_form.referee_id\">\r\n              <a-select v-model:value=\"eventForm.professional_form.referee_id\" :options=\"opts.coaches\">\r\n                <a-select-option></a-select-option>\r\n              </a-select>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"装备\" name=\"professional_form.equipment_provided\">\r\n              <a-textarea v-model:value=\"eventForm.professional_form.equipment_provided\"></a-textarea>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"12\">\r\n            <a-form-item label=\"比赛规则\" name=\"professional_form.rules_description\">\r\n              <a-textarea v-model:value=\"eventForm.professional_form.rules_description\"></a-textarea>\r\n            </a-form-item>\r\n          </a-col>\r\n        </a-row>\r\n\r\n        <a-form-item :wrapper-col=\"{ span: 12, offset: 10 }\">\r\n          <div class=\"steps-action\">\r\n            <a-button v-if=\"current < steps.length - 1\" type=\"primary\" @click=\"next\">下一步</a-button>\r\n            <a-button v-if=\"current > 0\" style=\"margin-left: 8px\" @click=\"prev\">上一步</a-button>\r\n            <a-button\r\n                v-if=\"current == steps.length - 1\"\r\n                type=\"primary\"\r\n                html-type=\"submit\"\r\n                @click=\"onSubmit\"\r\n            >\r\n              完成提交\r\n            </a-button>\r\n          </div>\r\n        </a-form-item>\r\n      </a-form>\r\n    </div>\r\n\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"less\">\r\n#container {\r\n  height: 500px;\r\n}\r\n\r\n</style>"],"names":["router","useRouter","eventFormRef","ref","current","opts","next","eventForm","initMapShow","prev","Api","resetAssociationForm","getData","param","initMap","steps","qrClick","onSubmit"],"mappings":"+nGAKA,MAAAA,EAAAC,KACAC,EAAAC,EAAA,IAAA,EACAC,EAAAD,EAAA,CAAA,EACAE,EAAAF,EAAA,CAAiB,OAAA,CAAA,EACN,QAAA,CAAA,EACC,QAAA,CAAA,EACA,YAAA,CAAA,CACG,CAAA,EAEfG,EAAA,IAAA,CAEEJ,EAAA,MAAA,SAAA,EAAA,KAAA,IAAA,CACEE,EAAA,QACAG,EAAA,MAAA,aAAA,WACEC,GACF,CAAA,CACD,EAEHC,EAAA,IAAA,CACEL,EAAA,OAAQ,GAEV,SAAA,CACEC,EAAA,MAAA,MAAAK,EAAA,gBAAA,YAAA,CAAmD,KAIrD,MAAAH,EAAAJ,EAAA,CAAsB,KAAA,GACd,MAAA,GACC,YAAA,GACM,WAAA,GAED,cAAA,KAEG,OAAA,GAEP,iBAAA,GAEU,iBAAA,GACA,WAAA,GACN,SAAA,GACF,sBAAA,GAEa,YAAA,GAEV,OAAA,GAEL,WAAA,GACI,aAAA,GACE,kBAAA,CACK,SAAA,EACP,SAAA,EACA,UAAA,EACC,aAAA,EACG,WAAA,EACF,mBAAA,GACQ,kBAAA,EACD,EACrB,aAAA,CACc,SAAA,GACF,IAAA,CACL,KAAA,QACG,YAAA,CAAA,WAAA,SAAA,CAC6B,EACrC,cAAA,GACe,eAAA,GACC,cAAA,GACD,gBAAA,GACE,aAAA,EACH,CAChB,CAAA,EAEFQ,EAAA,IAAA,CACEJ,EAAA,MAAA,kBAAA,CAAoC,SAAA,EACxB,SAAA,EACA,UAAA,EACC,aAAA,EACG,WAAA,EACF,mBAAA,GACQ,kBAAA,EACD,EAErBA,EAAA,MAAA,aAAA,CAA+B,SAAA,GACnB,IAAA,CACL,KAAA,QACG,YAAA,CAAA,WAAA,SAAA,CAC6B,EACrC,cAAA,GACe,eAAA,GACC,cAAA,GACD,gBAAA,GACE,aAAA,EACH,CAChB,EAEFK,EAAAC,GAAA,CACEN,EAAA,MAAA,aAAA,IAAA,YAAA,CAAA,EAAAM,EAAA,IACAN,EAAA,MAAA,aAAA,IAAA,YAAA,CAAA,EAAAM,EAAA,GAAwD,EAG1DL,EAAA,IAAA,CACE,WAAA,IAAA,CACEM,GAAAF,EAAA,CAAiBL,EAAA,MAAA,aAAA,IAAA,YAAA,CAAA,EAC+BA,EAAA,MAAA,aAAA,IAAA,YAAA,CAAA,CACA,CAAA,CAC/C,EAAA,GAAA,CACI,EAITQ,EAAA,CAAc,CACZ,MAAA,OACS,QAAA,eACE,EACX,CACA,MAAA,OACS,QAAA,gBACE,CACX,EAGFC,EAAA,SAAA,CACET,EAAA,MAAA,KAAA,MAAAG,EAAA,aAAA,QAAqD,EAGvDO,EAAA,SAAA,CACE,MAAAP,EAAA,gBAAA,MAAAH,EAAA,KAAA,EACAL,EAAA,MAAA,cACAS,IACAX,EAAA,GAAA,EAAA,CAAY;;;"}