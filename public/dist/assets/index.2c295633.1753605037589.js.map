{"version":3,"file":"index.2c295633.1753605037589.js","sources":["../../src/composible/useRole.ts","../../src/pages/system/auth/role/index.vue"],"sourcesContent":["import XEUtils from \"xe-utils\";\r\nimport Api from \"@/api\"\r\nimport {VxeGridProps} from \"vxe-table\";\r\nimport {request} from \"@/utils/request\";\r\n\r\nclass RowVO {\r\n}\r\nexport default () => {\r\n    // 方法\r\n\r\n    // 表单配置\r\n    const serveApiUrl = import.meta.env.VITE_API_URL;\r\n    const gridOptions = reactive<VxeGridProps<RowVO>>({\r\n        border: \"full\",\r\n        size: \"small\",\r\n        showHeaderOverflow: true,\r\n        showOverflow: true,\r\n        keepSource: true,\r\n        autoResize: true,\r\n\r\n        expandConfig: {\r\n            trigger: \"row\",\r\n            showIcon: true,\r\n            expandRowKeys: [1, 2],\r\n            iconOpen: \"vxe-icon--caret-bottom\",\r\n            iconClose: \"vxe-icon--caret-top\",\r\n        },\r\n        formConfig: {\r\n            titleWidth: 120,\r\n            titleAlign: \"right\",\r\n            items: [\r\n                {\r\n                    field: \"name\",\r\n                    title: \"角色名称\",\r\n                    span: 6,\r\n                    itemRender: {\r\n                        name: \"$input\",\r\n                        props: { placeholder: \"请输入角色名称\" },\r\n                    },\r\n                },\r\n                {\r\n                    field: \"label\",\r\n                    title: \"角色标题\",\r\n                    span: 6,\r\n                    itemRender: {\r\n                        name: \"$input\",\r\n                        props: { placeholder: \"请输入用户手机号\" },\r\n                    },\r\n                },\r\n                {\r\n                    span: 8,\r\n                    align: \"left\",\r\n                    collapseNode: true,\r\n                    itemRender: {\r\n                        name: \"$buttons\",\r\n                        children: [\r\n                            {\r\n                                props: {\r\n                                    type: \"submit\",\r\n                                    content: \"搜索\",\r\n                                    status: \"primary\",\r\n                                },\r\n                            },\r\n                            { props: { type: \"reset\", content: \"重置\" } },\r\n                        ],\r\n                    },\r\n                },\r\n            ],\r\n        },\r\n        stripe: true,\r\n        id: \"full_edit_9999\",\r\n        rowConfig: {\r\n            keyField: \"#\",\r\n            isHover: true,\r\n            useKey: true,\r\n        },\r\n        columnConfig: {\r\n            resizable: true,\r\n        },\r\n        customConfig: {\r\n            storage: true,\r\n            checkMethod({ column }) {\r\n                if ([\"name\", \"no\"].includes(column.field)) {\r\n                    return false;\r\n                }\r\n                return true;\r\n            },\r\n        },\r\n        printConfig: {\r\n            columns: [{ field: \"name\" }],\r\n        },\r\n        sortConfig: {\r\n            trigger: \"cell\",\r\n            remote: true,\r\n        },\r\n        filterConfig: {\r\n            remote: true,\r\n        },\r\n        pagerConfig: {\r\n            enabled: true,\r\n            pageSize: 10,\r\n            pageSizes: [5, 10, 15, 20, 50, 100, 200, 500, 1000],\r\n        },\r\n\r\n        toolbarConfig: {\r\n            buttons: [\r\n                // {code: \"insert_actived\", name: \"快捷新增\", status: \"primary\"},\r\n                // {code: \"delete\", name: \"直接删除\", status: \"danger\"},\r\n                // {code: \"mark_cancel\", name: \"删除/取消\"},\r\n                // {code: \"save\", name: \"保存\", status: \"success\"},\r\n            ],\r\n            refresh: true, // 显示刷新按钮\r\n            import: false, // 显示导入按钮\r\n            export: true, // 显示导出按钮\r\n            print: true, // 显示打印按钮\r\n            zoom: true, // 显示全屏按钮\r\n            custom: true, // 显示自定义列按钮\r\n        },\r\n        proxyConfig: {\r\n            seq: true, // 启用动态序号代理，每一页的序号会根据当前页数变化\r\n            sort: true, // 启用排序代理，当点击排序时会自动触发 query 行为\r\n            filter: true, // 启用筛选代理，当点击筛选时会自动触发 query 行为\r\n            form: true, // 启用表单代理，当点击表单提交按钮时会自动触发 reload 行为\r\n            props: {\r\n                // 对应响应结果 Promise<{ result: [], page: { total: 100 } }>\r\n                result: \"data\", // 配置响应结果列表字段\r\n                total: \"total\", // 配置响应结果总页数字段\r\n            },\r\n            // 只接收Promise，具体实现自由发挥\r\n            ajax: {\r\n                // 当点击工具栏查询按钮或者手动提交指令 query或reload 时会被触发\r\n                query: ({ page, sorts, filters, form }) => {\r\n                    const queryParams: any = Object.assign({}, form);\r\n                    // 处理排序条件\r\n                    const firstSort = sorts[0];\r\n                    if (firstSort) {\r\n                        queryParams.sort = firstSort.field;\r\n                        queryParams.order = firstSort.order;\r\n                    }\r\n                    // 处理筛选条件\r\n                    filters.forEach(({ field, values }) => {\r\n                        queryParams[field] = values.join(\",\");\r\n                    });\r\n                    return request({\r\n                        url: `/api/admin/role?pageSize=${page.pageSize}&currentPage=${page.currentPage\r\n                        }&${XEUtils.serialize(queryParams)}`,\r\n                        method: \"GET\",\r\n                    });\r\n                },\r\n            },\r\n        },\r\n        columns: [\r\n            { field: \"id\", title: \"序号\", width: 100 },\r\n            // 配置日期选择器\r\n            {\r\n                field: \"name\",\r\n                title: \"角色名称\",\r\n                width: 300,\r\n                sortable: true,\r\n            },\r\n            {\r\n                field: \"label\",\r\n                title: \"角色标题\",\r\n                width: 200,\r\n                //当为in是显示登录，out时显示退出\r\n                sortable: true,\r\n            },\r\n            {\r\n                field: \"remark\",\r\n                title: \"角色备注\",\r\n            },\r\n            {\r\n                field: \"action\",\r\n                title: \"操作\",\r\n                sortable: true,\r\n                slots: {\r\n                    default: \"action\",\r\n                },\r\n                width: 320,\r\n            },\r\n        ],\r\n        importConfig: {},\r\n        exportConfig: {},\r\n        checkboxConfig: {\r\n            labelField: \"ID\",\r\n            checkStrictly: true,\r\n        },\r\n        editRules: {\r\n            name: [\r\n                { required: true, message: \"必填\" },\r\n                { min: 3, max: 50, message: \"名称长度在 3 到 50 个字符\" },\r\n            ],\r\n            no: [{ required: true, message: \"必填\" }],\r\n        },\r\n        editConfig: {\r\n            trigger: \"click\",\r\n            mode: \"row\",\r\n            showStatus: true,\r\n            showUpdateStatus: true,\r\n            showInsertStatus: true,\r\n            autoClear: true,\r\n        },\r\n    });\r\n\r\n    return {\r\n        gridOptions,\r\n    };\r\n};\r\n","<script setup lang=\"ts\">\r\nimport useRole from \"@/composible/useRole\";\r\nimport Api from \"@/api\";\r\nimport {TreeProps} from \"ant-design-vue\";\r\nimport {VxeGridListeners} from \"vxe-table\";\r\n\r\nconst {gridOptions} = useRole()\r\n// TABLE\r\nconst xGrid = ref()\r\n\r\ninterface RowVO {\r\n}\r\n\r\nconst gridEvent: VxeGridListeners<RowVO> = {\r\n  proxyQuery() {\r\n    console.log('数据代理查询事件')\r\n    const grid = xGrid.value\r\n    // 获取表格中的数据\r\n    const data = grid.getTableData().fullData\r\n  },\r\n  proxyDelete() {\r\n    console.log('数据代理删除事件')\r\n  },\r\n  proxySave() {\r\n    console.log('数据代理保存事件')\r\n  }\r\n}\r\n/*\r\n* 设置权限 */\r\nconst open = ref(false)\r\nconst role_id = ref(null)\r\nconst setPer = (row) => {\r\n  open.value = true;\r\n  role_id.value = row.id\r\n}\r\nconst onClose = () => {\r\n  open.value = false;\r\n}\r\nconst tableRef = ref()\r\nconst onSubmit = async () => {\r\n  // console.log('submit!')\r\n  // 获取表单中的数据\r\n  const data = tableRef.value.getCheckboxRecords()\r\n  console.log(data)\r\n  //构造数据\r\n  let auth_items = data.map(item => {\r\n    return {\r\n      permission: item.permission,\r\n      auth_api: item.api_auth\r\n    }\r\n  })\r\n  let req = Object.assign({},{\r\n    auth_items: auth_items\r\n  })\r\n  console.log(req)\r\n  await Api.roleController.syncPermissions({id: role_id.value}, req)\r\n}\r\nconst tableData = ref<TreeProps['treeData']>([]);\r\nconst getMenu = async () => {\r\n  // @ts-ignore\r\n  tableData.value = await Api.menuController.option()\r\n}\r\n\r\nconst treeConfig = reactive<VxeTablePropTypes.TreeConfig<RowVO>>({\r\n  size: \"small\",\r\n  transform: true,\r\n  rowField: 'id',\r\n  parentField: 'pid',\r\n  checkboxConfig: {\r\n    labelField: 'id',\r\n    highlight: true\r\n  },\r\n  lazy: true,\r\n  hasChild: 'hasChild',\r\n})\r\n\r\nconst expandConfig = ref<VxeTablePropTypes.ExpandConfig<RowVO>>({\r\n  lazy: true,\r\n  async loadMethod({row}) {\r\n    const data = await Api.menuController.permissions({id: row.id})\r\n    Object.assign(row, {childData: data, api_auth: []})\r\n  }\r\n})\r\ngetMenu()\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <vxe-grid ref='xGrid' v-bind=\"gridOptions\" v-on=\"gridEvent\">\r\n      <template #action=\"{ row }\">\r\n        <div>\r\n          <a-button type=\"primary\">删除</a-button>\r\n          <a-button type=\"primary\">编辑</a-button>\r\n          <a-button type=\"primary\" @click=\"setPer(row)\">权限</a-button>\r\n        </div>\r\n      </template>\r\n    </vxe-grid>\r\n    <a-drawer title=\"配置权限\" size=\"large\" v-model:visible=\"open\" @close=\"onClose\">\r\n      <template #extra>\r\n        <a-button style=\"margin-right: 8px\" @click=\"onClose\">取消</a-button>\r\n        <a-button type=\"primary\" @click=\"onSubmit\">确认</a-button>\r\n      </template>\r\n      <vxe-table\r\n          size=\"small\"\r\n          border\r\n          ref=\"tableRef\"\r\n          :row-config=\"{keyField: 'id'}\"\r\n          :column-config=\"{resizable: true}\"\r\n          :expand-config=\"expandConfig\"\r\n          :tree-config=\"treeConfig\"\r\n          :data=\"tableData\">\r\n        <vxe-column field=\"id\" type=\"checkbox\" title=\"id\" width=\"70\" tree-node></vxe-column>\r\n        <vxe-column type=\"expand\" width=\"80\" title=\"API权限\">\r\n          <template #content=\"{ row }\">\r\n            <div class=\"expand-wrapper\">\r\n              <a-checkbox-group v-model:value=\"row.api_auth\">\r\n                <a-row>\r\n                  <a-col :span=\"8\" v-for=\"(i,ind) in row.childData\" :key=\"ind\">\r\n                    <a-checkbox :value=\"i.code\">\r\n                      {{ i.name }}\r\n                    </a-checkbox>\r\n                  </a-col>\r\n                </a-row>\r\n              </a-checkbox-group>\r\n            </div>\r\n          </template>\r\n        </vxe-column>\r\n        <vxe-column field=\"name\" title=\"标识\"></vxe-column>\r\n        <vxe-column field=\"title\" title=\"名称\"></vxe-column>\r\n        <vxe-column field=\"path\" title=\"路径\"></vxe-column>\r\n      </vxe-table>\r\n    </a-drawer>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"less\">\r\n.expand-wrapper {\r\n  padding: 20px;\r\n}\r\n</style>"],"names":["useRole","reactive","column","page","sorts","filters","form","queryParams","firstSort","field","values","request","XEUtils","gridOptions","xGrid","ref","gridEvent","open","role_id","setPer","row","onClose","tableRef","onSubmit","data","auth_items","item","req","Api","tableData","getMenu","treeConfig","expandConfig"],"mappings":"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"}