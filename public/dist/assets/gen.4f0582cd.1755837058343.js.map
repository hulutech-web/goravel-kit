{"version":3,"file":"gen.4f0582cd.1755837058343.js","sources":["../../src/pages/system/crud/templates/gen.ts"],"sourcesContent":["function generateCreateTableSQL(tableName, columns) {\r\n    // 默认添加的字段定义（不包括 id）\r\n    const defaultColumns = [\r\n        { column: 'created_at', type_name: 'datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3)', index: true },\r\n        { column: 'updated_at', type_name: 'datetime(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3)', index: true },\r\n        { column: 'deleted_at', type_name: 'datetime(3) DEFAULT NULL' }\r\n    ];\r\n\r\n    // 定义 id 字段\r\n    const idColumn = {\r\n        column: 'id',\r\n        type_name: 'bigint(20) unsigned NOT NULL AUTO_INCREMENT',\r\n        primary_key: true\r\n    };\r\n\r\n    // 构建用户提供的字段定义字符串\r\n    const userColumns = columns.map(col => ({\r\n        ...col,\r\n        def: `${col.column} ${col.type_name}${col.not_null === \"1\" ? ' NOT NULL' : ''}${col.default !== undefined && col.default !== null ? ` DEFAULT ${col.default}` : ''}${col.unique === \"1\" ? ' UNIQUE' : ''}`\r\n    }));\r\n\r\n    // 确保只有一个主键并且是 id\r\n    const hasPrimaryKey = userColumns.some(col => col.primary_key === \"1\");\r\n    if (hasPrimaryKey) {\r\n        console.warn('Primary key should only be set for the \"id\" field.');\r\n        userColumns.forEach(col => delete col.primary_key); // 移除用户设置的主键属性\r\n    }\r\n\r\n    // 构建字段定义字符串，先放 id 字段，再放用户字段，最后放默认字段\r\n    const columnDefs = [\r\n        `${idColumn.column} ${idColumn.type_name}`,\r\n        ...userColumns.map(col => col.def),\r\n        ...defaultColumns.map(col => `${col.column} ${col.type_name}`)\r\n    ].join(',\\n  ');\r\n\r\n    // 构建索引定义字符串\r\n    const indexDefs = defaultColumns.filter(col => col.index).map(col => `KEY idx_${tableName}_${col.column} (${col.column})`).join(',\\n  ');\r\n\r\n    // 添加主键定义\r\n    const primaryKeyDef = idColumn.primary_key ? `PRIMARY KEY (id)` : '';\r\n\r\n    // 构建最终的 SQL 语句\r\n    const sql = `\r\nCREATE TABLE ${tableName} (\r\n  ${columnDefs}\r\n  ${primaryKeyDef ? `, ${primaryKeyDef}` : ''}\r\n  ${indexDefs ? `, ${indexDefs}` : ''}\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\r\n`;\r\n\r\n    return sql.trim().replace(/\\n\\s*,\\s*\\n/g, '\\n  ').replace(/,\\s*$/, '');\r\n}\r\n\r\nexport {\r\n    generateCreateTableSQL\r\n}"],"names":["generateCreateTableSQL","tableName","columns","defaultColumns","idColumn","userColumns","col","columnDefs","indexDefs"],"mappings":"AAAA,SAASA,EAAuBC,EAAWC,EAAS,CAEhD,MAAMC,EAAiB,CACnB,CAAE,OAAQ,aAAc,UAAW,oDAAqD,MAAO,EAAK,EACpG,CAAE,OAAQ,aAAc,UAAW,mFAAoF,MAAO,EAAK,EACnI,CAAE,OAAQ,aAAc,UAAW,0BAA2B,CAAA,EAI5DC,EAAW,CACb,OAAQ,KACR,UAAW,8CACX,YAAa,EAAA,EAIXC,EAAcH,EAAQ,IAAYI,IAAA,CACpC,GAAGA,EACH,IAAK,GAAGA,EAAI,MAAM,IAAIA,EAAI,SAAS,GAAGA,EAAI,WAAa,IAAM,YAAc,EAAE,GAAGA,EAAI,UAAY,QAAaA,EAAI,UAAY,KAAO,YAAYA,EAAI,OAAO,GAAK,EAAE,GAAGA,EAAI,SAAW,IAAM,UAAY,EAAE,EAC1M,EAAA,EAGoBD,EAAY,KAAYC,GAAAA,EAAI,cAAgB,GAAG,IAEjE,QAAQ,KAAK,oDAAoD,EACjED,EAAY,QAAQC,GAAO,OAAOA,EAAI,WAAW,GAIrD,MAAMC,EAAa,CACf,GAAGH,EAAS,MAAM,IAAIA,EAAS,SAAS,GACxC,GAAGC,EAAY,IAAIC,GAAOA,EAAI,GAAG,EACjC,GAAGH,EAAe,IAAWG,GAAA,GAAGA,EAAI,MAAM,IAAIA,EAAI,SAAS,EAAE,CAAA,EAC/D,KAAK;AAAA,GAAO,EAGRE,EAAYL,EAAe,OAAOG,GAAOA,EAAI,KAAK,EAAE,IAAWA,GAAA,WAAWL,CAAS,IAAIK,EAAI,MAAM,KAAKA,EAAI,MAAM,GAAG,EAAE,KAAK;AAAA,GAAO,EAchI,MARK;AAAA,eACDL,CAAS;AAAA,IACpBM,CAAU;AAAA;AAAA,IAEVC,EAAY,KAAKA,CAAS,GAAK,EAAE;AAAA;AAAA,EAItB,KAAO,EAAA,QAAQ,eAAgB;AAAA,GAAM,EAAE,QAAQ,QAAS,EAAE,CACzE"}