{"version":3,"file":"chapter.e7b6d8a1.1753605037589.js","sources":["../../src/pages/course/chapter.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport Api from \"@/api\";\r\nimport {VxeToolbarEvents, VxeToolbarPropTypes} from \"vxe-pc-ui/types/components/toolbar\";\r\n\r\nconst route = useRoute();\r\nconst id = ref(route.params.id);\r\nconst course = ref({})\r\nconst serveApiUrl = import.meta.env.VITE_API_URL;\r\nconst chapterForm = ref({\r\n  content: \"\",\r\n  course_id: \"\",\r\n  duration: 60,\r\n  image: \"\",\r\n  remark: \"\",\r\n  serial: 0,\r\n  sort: \"\",\r\n  target: \"\",\r\n  title: \"\",\r\n})\r\nconst chapterForms = ref({\r\n  chapters: []\r\n})\r\n\r\nconst getChapter = async () => {\r\n  course.value = await Api.courseController.show({id: id.value})\r\n\r\n\r\n  const data = await Api.courseController.chapter({id: id.value});\r\n  chapterForms.value.chapters = data;\r\n  console.log(chapterForms.value)\r\n  initTable()\r\n};\r\n\r\n\r\ngetChapter()\r\nconst tableRef = ref(null)\r\nconst toolbarRef = ref(null)\r\n\r\nconst toolbarButtons = ref<VxeToolbarPropTypes.Buttons>([\r\n  // {name: '新增', code: 'add', status: 'primary'},\r\n  // {name: '删除', code: 'del', status: 'error'},\r\n  {name: '保存', code: 'save', status: 'success'}\r\n])\r\n\r\nconst buttonClickEvent: VxeToolbarEvents.ButtonClick = async ({code}) => {\r\n  switch (code) {\r\n    case \"add\":\r\n      chapterForms.value.chapters.push(chapterForm.value)\r\n      break;\r\n    case \"del\":\r\n      chapterForms.value.chapters = chapterForms.value.chapters.filter(i => i.id !== chapterForm.value.id)\r\n      break;\r\n    case \"save\":\r\n      await Api.courseController.saveChapter({id: id.value}, chapterForms.value)\r\n      getChapter()\r\n      // tableRef.value.commitProxy('query')\r\n      break;\r\n  }\r\n}\r\n\r\nconst initTable = () => {\r\n  if (chapterForms.value.chapters.length == 0) {\r\n    //   根据course的课程节数，初始化chapter表格的行数\r\n    chapterForms.value.chapters = Array.from({length: course.value.coupon_template.times}, (_, i) => ({\r\n      id: i + 1,\r\n      serial: i + 1,\r\n      title: `第${i + 1}节`,\r\n      content: \"\",\r\n      remark: \"\",\r\n      image: \"\",\r\n      duration: 60,\r\n      target: \"\",\r\n    }))\r\n  }\r\n}\r\n\r\nonMounted(() => {\r\n  const $table = tableRef.value\r\n  const $toolbar = toolbarRef.value\r\n  if ($table && $toolbar) {\r\n    $table.connect($toolbar)\r\n  }\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <a-divider>课程</a-divider>\r\n    <a-descriptions :size=\"'small'\" bordered layout=\"vertical\" :column=\"6\">\r\n      <a-descriptions-item label=\"标题\">{{ course.title }}</a-descriptions-item>\r\n      <a-descriptions-item label=\"节数\">{{ course.total }}</a-descriptions-item>\r\n      <a-descriptions-item label=\"节数\">{{\r\n          course.coupon_template ? course.coupon_template.times : '暂无'\r\n        }}\r\n      </a-descriptions-item>\r\n      <a-descriptions-item label=\"价格\">{{\r\n          course.coupon_template ? course.coupon_template.total : '暂无'\r\n        }}\r\n      </a-descriptions-item>\r\n      <a-descriptions-item label=\"标签\">{{ course.tags }}</a-descriptions-item>\r\n      <a-descriptions-item label=\"描述\">{{ course.description }}</a-descriptions-item>\r\n      <a-descriptions-item label=\"场馆\">{{ course.venue ? course.venue.name : '暂无' }}</a-descriptions-item>\r\n      <a-descriptions-item label=\"时长\">{{ course.duration }}</a-descriptions-item>\r\n      <a-descriptions-item label=\"封面\" :span=\"2\" v-if=\"course.cover\">\r\n        <vxe-image :src=\"`${serveApiUrl}/uploads/${course.cover}`\" width=\"48\" height=\"48\"></vxe-image>\r\n      </a-descriptions-item>\r\n      <a-descriptions-item label=\"创建时间\">{{ course.created_at }}</a-descriptions-item>\r\n    </a-descriptions>\r\n    <a-divider>章节管理</a-divider>\r\n    <vxe-toolbar ref=\"toolbarRef\" :buttons=\"toolbarButtons\" @button-click=\"buttonClickEvent\"></vxe-toolbar>\r\n    <vxe-table\r\n        ref=\"tableRef\"\r\n        border\r\n        size=\"small\"\r\n        :cell-config=\"{height:90}\"\r\n        show-overflow\r\n        :edit-config=\"{mode: 'row', trigger: 'click'}\"\r\n        :data=\"chapterForms.chapters\">\r\n      <vxe-column field=\"serial\" title=\"序号\" width=\"90\" sortable :edit-render=\"{ name: 'AInputNumber' }\"></vxe-column>\r\n      <vxe-column field=\"title\" title=\"标题\"  :edit-render=\"{ name: 'VxeInput' }\"></vxe-column>\r\n      <vxe-column field=\"content\" title=\"内容\" width=\"600\">\r\n        <template #default=\"{row}\">\r\n          <vxe-textarea v-model=\"row.content\" style=\"height: 80px;\"\r\n                        placeholder=\"水中行走：在浅水区练习平衡，适应水压和阻力。\r\n呼吸训练：口吸鼻呼的节奏练习，水中憋气与换气。\r\n漂浮练习：扶池壁完成俯卧/仰卧漂浮，学会从漂浮状态站立。\r\n蹬壁滑行：借助池壁蹬出，保持身体流线型滑行。\r\n辅助器材使用：浮板辅助踢腿练习，培养水感。\r\n\">\r\n          </vxe-textarea>\r\n        </template>\r\n      </vxe-column>\r\n      <vxe-column field=\"remark\" title=\"备注\">\r\n        <template #default=\"{row}\">\r\n          <vxe-textarea v-model=\"row.remark\" style=\"height: 80px;\"></vxe-textarea>\r\n        </template>\r\n      </vxe-column>\r\n      <vxe-column field=\"image\" title=\"图片\">\r\n        <template #default=\"{ row }\">\r\n          <a-space>\r\n            <vxe-image :src=\"`${serveApiUrl}/uploads/${row.image}`\" width=\"64\" height=\"64\"></vxe-image>\r\n            <FileSelect ref=\"fileRef\" v-model=\"row.image\">\r\n            </FileSelect>\r\n          </a-space>\r\n\r\n        </template>\r\n      </vxe-column>\r\n      <vxe-column field=\"pointer\" title=\"知识点（项）\" :edit-render=\"{ name: 'AInputNumber' }\">\r\n      </vxe-column>\r\n      <vxe-column field=\"duration\" title=\"时长(分钟)\" :edit-render=\"{ name: 'AInputNumber' }\">\r\n      </vxe-column>\r\n      <vxe-column field=\"target\" title=\"课程目标\">\r\n        <template #default=\"{ row }\">\r\n          <a-select\r\n              v-model:value=\"row.target\"\r\n              mode=\"tags\"\r\n              placeholder=\"Please select\"\r\n              style=\"width: 120px\"\r\n          ></a-select>\r\n        </template>\r\n      </vxe-column>\r\n    </vxe-table>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"less\">\r\n\r\n</style>"],"names":["route","useRoute","id","ref","course","serveApiUrl","chapterForm","chapterForms","getChapter","Api","data","initTable","tableRef","toolbarRef","toolbarButtons","buttonClickEvent","code","i","_","onMounted","$table","$toolbar"],"mappings":"0vFAIA,MAAAA,EAAAC,IACAC,EAAAC,EAAAH,EAAA,OAAA,EAAA,EACAI,EAAAD,EAAA,CAAA,CAAA,EACAE,EAAA,sBACAC,EAAAH,EAAA,CAAwB,QAAA,GACb,UAAA,GACE,SAAA,GACD,MAAA,GACH,OAAA,GACC,OAAA,EACA,KAAA,GACF,OAAA,GACE,MAAA,EACD,CAAA,EAETI,EAAAJ,EAAA,CAAyB,SAAA,CAAA,CACZ,CAAA,EAGbK,EAAA,SAAA,CACEJ,EAAA,MAAA,MAAAK,EAAA,iBAAA,KAAA,CAAA,GAAAP,EAAA,KAAA,CAAA,EAGA,MAAAQ,EAAA,MAAAD,EAAA,iBAAA,QAAA,CAAA,GAAAP,EAAA,KAAA,CAAA,EACAK,EAAA,MAAA,SAAAG,EACA,QAAA,IAAAH,EAAA,KAAA,EACAI,GAAU,EAIZH,IACA,MAAAI,EAAAT,EAAA,IAAA,EACAU,EAAAV,EAAA,IAAA,EAEAW,EAAAX,EAAA,CAAwD,CAAA,KAAA,KAAA,KAAA,OAAA,OAAA,SAAA,CAGV,CAAA,EAG9CY,EAAA,MAAA,CAAA,KAAAC,KAAA,CACE,OAAAA,EAAA,CAAc,IAAA,MAEVT,EAAA,MAAA,SAAA,KAAAD,EAAA,KAAA,EACA,MAAA,IAAA,MAEAC,EAAA,MAAA,SAAAA,EAAA,MAAA,SAAA,OAAAU,GAAAA,EAAA,KAAAX,EAAA,MAAA,EAAA,EACA,MAAA,IAAA,OAEA,MAAAG,EAAA,iBAAA,YAAA,CAAA,GAAAP,EAAA,KAAA,EAAAK,EAAA,KAAA,EACAC,IAEA,KAAA,CACJ,EAGFG,EAAA,IAAA,CACEJ,EAAA,MAAA,SAAA,QAAA,IAEEA,EAAA,MAAA,SAAA,MAAA,KAAA,CAAA,OAAAH,EAAA,MAAA,gBAAA,KAAA,EAAA,CAAAc,EAAAD,KAAA,CAAkG,GAAAA,EAAA,EACxF,OAAAA,EAAA,EACI,MAAA,IAAAA,EAAA,CAAA,IACI,QAAA,GACP,OAAA,GACD,MAAA,GACD,SAAA,GACG,OAAA,EACF,EAAA,EAEZ,EAGF,OAAAE,EAAA,IAAA,CACE,MAAAC,EAAAR,EAAA,MACAS,EAAAR,EAAA,MACAO,GAAAC,GACED,EAAA,QAAAC,CAAA,CACF,CAAA;;;;;"}