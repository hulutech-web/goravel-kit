{"version":3,"file":"event_detail.f55df641.1753605037589.js","sources":["../../src/pages/event/event_detail.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport Api from \"@/api\";\nimport initMap from \"@/pages/venue/mapinit\";\n\nconst route = useRoute()\nconst id = ref(route.params.id)\nconst baseUrl = import.meta.env.VITE_API_URL;\nconst addFile = () => {\n  if (eventForm.value.addition_file == null) {\n    eventForm.value.addition_file = [];\n  }\n  eventForm.value.addition_file.push(\"\")\n  myFiles.value.push(\"\")\n}\nconst eventForm = ref({\n  id: null,\n  code: \"\",\n  title: \"\",\n  description: \"\",\n\n  event_type: \"\",\n\n  sport_type: \"\",\n\n  format: \"\",\n  max_participants: \"\",\n  min_participants: \"\",\n  start_time: \"\",\n  end_time: \"\",\n\n  registration_deadline: \"\",\n\n  cover_image: \"\",\n\n  status: \"\",\n  creator_id: \"\",\n  creator_role: \"\",\n  professional_event: {\n    venue_id: 0,\n    coach_id: 0,\n    ticket_id: 0,\n    ticket_price: 0,\n    referee_id: 0,\n    equipment_provided: \"\",\n    rules_description: \"\",\n    addition_file: []\n  },\n  outdoor_event: {\n    location: \"\",\n    gps: {\n      type: \"Point\",\n      coordinates: [107.466127, 31.224677],\n    },\n    meeting_point: \"\",\n    contact_person: \"\",\n    contact_phone: \"\",\n    bring_equipment: \"\",\n    weather_plan: \"\",\n  },\n  event_registrations: []\n})\nconst baseApiUrl = import.meta.env.VITE_API_URL ? import.meta.env.VITE_API_URL : '';\n\nconst myFiles = ref([])\nconst loadEvent = async () => {\n  if (id.value) {\n    eventForm.value = await Api.eventController.show({id: id.value})\n    myFiles.value = eventForm.value.professional_event.addition_file ? eventForm.value.professional_event.addition_file : [];\n    console.log(myFiles.value)\n  }\n}\nconst removeFile = (index) => {\n  myFiles.value.splice(index, 1)\n  console.log(myFiles.value)\n}\n\nconst saveEvent = async () => {\n  console.log(myFiles.value)\n  await Api.eventController.updateAdditionFile({id: eventForm.value.id}, {addition_file: myFiles.value})\n}\nconst statusState = computed(() => {\n  switch (eventForm.value.status) {\n    case 'draft':\n      return '草稿';\n    case 'published':\n      return '已发布';\n    case 'registration':\n      return '报名中';\n    case 'in_progress':\n      return '进行中';\n    case 'completed':\n      return '完成';\n    case 'cancelled':\n      return '取消';\n    default:\n      return '未知';\n  }\n})\nloadEvent();\n\nconst getData = (param) => {\n  eventForm.value.outdoor_event.gps.coordinates[1] = param.lat;\n  eventForm.value.outdoor_event.gps.coordinates[0] = param.lng;\n};\n\nconst initMapShow = () => {\n  setTimeout(() => {\n    initMap(getData, [\n      eventForm.value.outdoor_event.gps.coordinates[1],\n      eventForm.value.outdoor_event.gps.coordinates[0],\n    ]);\n  }, 1000);\n}\n</script>\n\n<template>\n  <div>\n    <div class=\"flex justify-center\">\n      <img :src=\"`${baseUrl}${eventForm.cover_image}`\" alt=\"\" style=\"width:200px;height:auto;\">\n    </div>\n    <div>\n      <a-card size=\"small\">\n\n        <a-divider>参赛详情</a-divider>\n        <a-descriptions title=\"\" size=\"small\" bordered layout=\"vertical\" v-if=\"eventForm.event_type==='outdoor'\"\n                        :column=\"3\">\n          <a-descriptions-item label=\"地址\" :span=\"1\">{{ eventForm.outdoor_event.location }}</a-descriptions-item>\n          <a-descriptions-item label=\"集合地点\" :span=\"1\">{{\n              eventForm.outdoor_event.meeting_point\n            }}\n          </a-descriptions-item>\n          <a-descriptions-item label=\"联系人\" :span=\"1\">{{\n              eventForm.outdoor_event.contact_person\n            }}\n          </a-descriptions-item>\n          <a-descriptions-item label=\"联系电话\" :span=\"1\">{{\n              eventForm.outdoor_event.contact_phone\n            }}\n          </a-descriptions-item>\n          <a-descriptions-item label=\"需自带装备\" :span=\"1\">{{\n              eventForm.outdoor_event.bring_equipment\n            }}\n          </a-descriptions-item>\n          <a-descriptions-item label=\"雨天备选方案\" :span=\"1\">{{\n              eventForm.outdoor_event.weather_plan\n            }}\n          </a-descriptions-item>\n          <a-descriptions-item label=\"坐标\" :span=\"3\">\n            <div id=\"container\" style=\"height: 200px;\"></div>\n          </a-descriptions-item>\n        </a-descriptions>\n\n        <a-descriptions title=\"\" bordered layout=\"vertical\" size=\"small\" v-if=\"eventForm.event_type==='professional'\"\n                        :column=\"4\">\n          <a-descriptions-item label=\"场馆\" :span=\"1\">\n            {{ eventForm.professional_event.venue ? eventForm.professional_event.venue.name : '' }}\n          </a-descriptions-item>\n          <a-descriptions-item label=\"门票\" :span=\"1\">\n            {{ eventForm.professional_event.ticket ? eventForm.professional_event.ticket.name : '' }}\n          </a-descriptions-item>\n          <a-descriptions-item label=\"裁判\" :span=\"1\">\n            {{ eventForm.professional_event.referee ? eventForm.professional_event.referee.username : '' }}\n          </a-descriptions-item>\n          <a-descriptions-item label=\"装备\" :span=\"1\">{{\n              eventForm.professional_event.equipment_provided\n            }}\n          </a-descriptions-item>\n          <a-descriptions-item label=\"比赛规则\" :span=\"4\">{{\n              eventForm.professional_event.rules_description\n            }}\n          </a-descriptions-item>\n        </a-descriptions>\n        <a-divider>赛事详情</a-divider>\n        <a-descriptions title=\"\" bordered layout=\"vertical\" size=\"small\" :column=\"4\">\n          <a-descriptions-item label=\"赛事编码\" :span=\"1\">{{ eventForm.code }}</a-descriptions-item>\n          <a-descriptions-item label=\"赛事标题\">{{ eventForm.title }}</a-descriptions-item>\n          <a-descriptions-item label=\"类别\">{{\n              eventForm.event_type === 'outdoor' ? '户外' : '专业'\n            }}\n          </a-descriptions-item>\n          <a-descriptions-item label=\"运动类型\">{{ eventForm.sport_type }}</a-descriptions-item>\n          <a-descriptions-item label=\"比赛形式\">{{ eventForm.format }}</a-descriptions-item>\n          <a-descriptions-item label=\"最大参赛人数\">{{ eventForm.max_participants }}</a-descriptions-item>\n          <a-descriptions-item label=\"最小开赛人数\">{{ eventForm.min_participants }}</a-descriptions-item>\n          <a-descriptions-item label=\"开赛时间\">{{ eventForm.start_time }}</a-descriptions-item>\n          <a-descriptions-item label=\"结束时间\">{{ eventForm.end_time }}</a-descriptions-item>\n          <a-descriptions-item label=\"介绍\">{{ eventForm.description }}</a-descriptions-item>\n          <a-descriptions-item label=\"报名截止时间\">{{ eventForm.registration_deadline }}</a-descriptions-item>\n          <a-descriptions-item label=\"赛事详情\">\n            <a-badge v-if=\"eventForm.status==='draft'\" status=\"default\" :text=\"statusState\"/>\n            <a-badge status=\"success\" v-if=\"eventForm.status==='completed'\" :text=\"statusState\"/>\n            <a-badge status=\"error\" v-if=\"eventForm.status==='cancelled'\" :text=\"statusState\"/>\n            <a-badge status=\"processing\" v-if=\"eventForm.status==='in_progress'\" :text=\"statusState\"/>\n            <a-badge status=\"warning\" v-if=\"eventForm.status==='registration'\" :text=\"statusState\"/>\n            <a-badge status=\"green\" v-if=\"eventForm.status==='published'\" :text=\"statusState\"/>\n          </a-descriptions-item>\n        </a-descriptions>\n        <a-divider>成绩发布</a-divider>\n        <a-space>\n\n          <a-button type=\"primary\" @click=\"addFile\">\n            <PlusOutlined/>\n          </a-button>\n          <a-button type=\"primary\" @click=\"saveEvent\">\n            保存\n          </a-button>\n        </a-space>\n\n        <div v-for=\"(f, ind) in myFiles\" class=\"flex justify-between items-center\"\n             :key=\"ind\">\n          <a-form-item\n              label=\"附件\"\n              style=\"flex:3;margin:12px;\"\n              :rules=\"{\n                      required: true,\n                      message: '不为空',\n                      trigger: 'change',\n                    }\"\n          >\n            <FileSelect v-model=\"myFiles[ind]\"/>\n            <a class=\"text-blue-500\" target=\"_blank\" :href=\"`${baseUrl}${f}`\">{{ f }}</a>\n          </a-form-item>\n          <MinusCircleOutlined\n              style=\"font-size: 24px;flex:1;margin-bottom:8px;\"\n              @click=\"removeFile(ind)\"\n          />\n        </div>\n\n        <a-divider>报名情况</a-divider>\n        <vxe-table\n            size=\"small\"\n            border=\"inner\"\n            ref=\"tableRef\"\n            :data=\"eventForm.event_registrations\">\n          <vxe-column field=\"username\" title=\"姓名\">\n            <template #default=\"{ row }\">\n             {{row.user.username}}\n            </template>\n          </vxe-column>\n          <vxe-column field=\"avatar\" title=\"头像\">\n            <template #default=\"{ row }\">\n              <a-image :src=\"`${baseUrl}${row.user.avatar}`\" style=\"width:36px;height:36px;\"></a-image>\n            </template>\n          </vxe-column>\n          <vxe-column field=\"phone\" title=\"手机号\">\n            <template #default=\"{ row }\">\n              {{row.user?row.user.phone:''}}\n            </template>\n          </vxe-column>\n          <vxe-column field=\"transaction_id\" title=\"订单号\"></vxe-column>\n          <vxe-column field=\"registration_time\" title=\"报名时间\"></vxe-column>\n        </vxe-table>\n      </a-card>\n    </div>\n  </div>\n</template>\n\n<style scoped lang=\"less\">\n\n</style>"],"names":["route","useRoute","id","ref","baseUrl","addFile","eventForm","myFiles","loadEvent","Api","removeFile","index","saveEvent","statusState","computed"],"mappings":"i9FAIA,MAAAA,EAAAC,IACAC,EAAAC,EAAAH,EAAA,OAAA,EAAA,EACAI,EAAA,sBACAC,EAAA,IAAA,CACEC,EAAA,MAAA,eAAA,OACEA,EAAA,MAAA,cAAA,IAEFA,EAAA,MAAA,cAAA,KAAA,EAAA,EACAC,EAAA,MAAA,KAAA,EAAA,CAAqB,EAEvBD,EAAAH,EAAA,CAAsB,GAAA,KAChB,KAAA,GACE,MAAA,GACC,YAAA,GACM,WAAA,GAED,WAAA,GAEA,OAAA,GAEJ,iBAAA,GACU,iBAAA,GACA,WAAA,GACN,SAAA,GACF,sBAAA,GAEa,YAAA,GAEV,OAAA,GAEL,WAAA,GACI,aAAA,GACE,mBAAA,CACM,SAAA,EACR,SAAA,EACA,UAAA,EACC,aAAA,EACG,WAAA,EACF,mBAAA,GACQ,kBAAA,GACD,cAAA,CAAA,CACH,EAClB,cAAA,CACe,SAAA,GACH,IAAA,CACL,KAAA,QACG,YAAA,CAAA,WAAA,SAAA,CAC6B,EACrC,cAAA,GACe,eAAA,GACC,cAAA,GACD,gBAAA,GACE,aAAA,EACH,EAChB,oBAAA,CAAA,CACsB,CAAA,EAIxBI,EAAAJ,EAAA,CAAA,CAAA,EACAK,EAAA,SAAA,CACEN,EAAA,QACEI,EAAA,MAAA,MAAAG,EAAA,gBAAA,KAAA,CAAA,GAAAP,EAAA,KAAA,CAAA,EACAK,EAAA,MAAAD,EAAA,MAAA,mBAAA,cAAAA,EAAA,MAAA,mBAAA,cAAA,CAAA,EACA,QAAA,IAAAC,EAAA,KAAA,EACF,EAEFG,EAAAC,GAAA,CACEJ,EAAA,MAAA,OAAAI,EAAA,CAAA,EACA,QAAA,IAAAJ,EAAA,KAAA,CAAyB,EAG3BK,EAAA,SAAA,CACE,QAAA,IAAAL,EAAA,KAAA,EACA,MAAAE,EAAA,gBAAA,mBAAA,CAAA,GAAAH,EAAA,MAAA,EAAA,EAAA,CAAA,cAAAC,EAAA,KAAA,CAAA,CAAqG,EAEvGM,EAAAC,GAAA,IAAA,CACE,OAAAR,EAAA,MAAA,OAAA,CAAgC,IAAA,QAE5B,MAAA,KAAO,IAAA,YAEP,MAAA,MAAO,IAAA,eAEP,MAAA,MAAO,IAAA,cAEP,MAAA,MAAO,IAAA,YAEP,MAAA,KAAO,IAAA,YAEP,MAAA,KAAO,QAEP,MAAA,IAAO,CACX,CAAA,EAEF,OAAAE;;"}