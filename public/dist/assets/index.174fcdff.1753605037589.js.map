{"version":3,"file":"index.174fcdff.1753605037589.js","sources":["../../src/components/file-manager/FileUpload.vue","../../src/components/file-manager/FileList.vue","../../src/components/file-manager/FoldCreate.vue","../../src/components/file-manager/FileManager.vue"],"sourcesContent":["<template>\n  <div>\n    <slot name=\"default\">\n\n    </slot>\n    <a-modal v-model:visible=\"innerVisible\" title=\"上传文件\" @cancel=\"handleClose\" style=\"width:500px;\"\n             :maskClosable=\"false\" :center=\"true\">\n      <a-form-item label=\"文件夹\">\n        <a-select @change=\"changeCate\">\n          <a-select-option value=\"\">请选择分类</a-select-option>\n          <a-select-option v-for=\"(c,ind) in myFolders\" :key=\"ind\" :value=\"c.id\">{{ c.name }}</a-select-option>\n        </a-select>\n      </a-form-item>\n\n      <a-upload-dragger\n          v-model:fileList=\"fileList\"\n          name=\"file\"\n          :multiple=\"true\"\n          :action=\"`/api/admin/upload?cate_id=${my_id}`\"\n          :headers=\"headers\"\n          @change=\"handleChange\"\n      >\n        <p class=\"ant-upload-drag-icon\">\n          <inbox-outlined></inbox-outlined>\n        </p>\n        <p class=\"ant-upload-text\">点击或者拖拽上传内容</p>\n        <p class=\"ant-upload-hint\">\n          支持多种格式，单文件多文件都支持\n        </p>\n      </a-upload-dragger>\n    </a-modal>\n  </div>\n\n</template>\n\n<script setup>\nimport {ref} from 'vue';\nimport {InboxOutlined} from '@ant-design/icons-vue';\nimport {message} from \"ant-design-vue\";\n\nconst fileCateID = ref(null)\nconst handleChange = (info) => {\n  const status = info.file.status;\n  if (status !== 'uploading') {\n    // console.log(info.file, info.fileList);\n  }\n  if (status === 'done') {\n    message.success(`${info.file.name} file uploaded successfully.`);\n  } else if (status === 'error') {\n    message.error(`上传失败：${info.file.response.data}`);\n  }\n};\n\nconst headers = {\n  Authorization: 'Bearer ' + localStorage.getItem(\"token\")\n}\n\nconst props = defineProps({\n  modelValue: Boolean,\n  cate_id: Number,\n  folders: Array,\n});\n\nconst fileList = ref([]);\n\nconst myFolders = ref([]);\n\nconst uploadRef = ref();\nconst emit = defineEmits(['update:modelValue', 'success']);\nconst innerVisible = ref(props.modelValue);\n\nwatch(() => props.modelValue, (val) => {\n  innerVisible.value = val;\n})\nconst my_id = ref(null)\nwatch(() => props.cate_id, (val) => {\n  my_id.value = val;\n})\nwatch(() => props.folders, (val) => {\n  myFolders.value = val\n})\nconst submitUpload = () => {\n  if (my_id.value) {\n    uploadRef.value.upload.submit();\n  } else {\n    message.error(\"请选择上传的文件夹\")\n  }\n\n}\n\n\nconst changeCate = (e) => {\n  my_id.value = e\n}\nconst handleClose = () => {\n  emit('update:modelValue', false);\n};\n</script>\n","<template>\n  <div class=\"mt-3\">\n\n    <a-row :gutter=\"[32,2]\">\n      <a-col :span=\"4\">\n        <div>\n          <a-divider size=\"small\">\n            <span class=\"text-sm\">文件夹</span>\n          </a-divider>\n          <div v-for=\"(f,ind) in myFolders\" :key=\"ind\" @click=\"setPid(f)\"\n               class=\"flex h-12 w-full cursor-pointer text-sky-400 border border-solid border-gray-200 px-3 py-4\">\n            {{ f.name }}\n          </div>\n        </div>\n      </a-col>\n      <a-col :span=\"20\">\n        <a-space>\n          <a-input placeholder=\"请输入内容\" v-model:value=\"pageForm.name\" style=\"width:400px;\">\n          </a-input>\n          <a-button type=\"primary\" danger @click=\"searchBy\">搜索</a-button>\n          <a-button type=\"primary\" plain @click=\"pageForm.name=''\">清空</a-button>\n          <FileUpload v-model=\"uploadVisible\" v-model:cate_id=\"pageForm.cid\" :folders=\"myFolders\">\n            <a-button @click=\"uploadVisible=true\">上传文件</a-button>\n          </FileUpload>\n          <a-button type=\"primary\" v-show=\"del_obj.del_ids.length>0\" danger plain @click=\"delBatch\">删除</a-button>\n        </a-space>\n        <div class=\"border border-solid border-stone-200\">\n          <a-checkbox-group v-model:value=\"del_obj.del_ids\" class=\"min-h-[700px] mt-2\" style=\"width: 100%\">\n            <a-row :gutter=\"[32,64]\">\n              <a-col :span=\"3\" v-for=\"(f,ind) in files\" :key=\"ind\">\n                <div class=\"w-[140px] h-[140px] text-center\" style=\"border: .5px dotted #e5e7eb;\">\n                  <a-image\n                      v-if=\"f.type==='image'\"\n                      ref=\"imageRef\"\n                      :height=\"140\"\n                      style=\"height:140px;object-fit: cover;\"\n                      :src=\"`${baseApiUrl}/uploads/${f.path}`\"\n                      :preview-src-list=\"[`${baseApiUrl}/uploads/${f.path}`]\"\n                  />\n                  <file-filled @click=\"showFile(f.path)\" :height=\"'160px'\" :width=\"'160px'\"\n                               style=\"width: 160px; height: 160px;font-size:160px;color:#e6a23c\" v-else/>\n                  <div class=\"text-center font-light text-xs text-blue-400\">\n                    <div class=\"flex\">\n                      <a-input\n                          class=\"flex-1\"\n                          ref=\"inputRef\"\n                          v-model:value=\"f.name\"\n                          type=\"text\"\n                          size=\"small\"\n                          :style=\"{ width: '100%',color:'grey' }\"\n                      />\n                      <a-button size=\"small\" type=\"link\" @click=\"changeName(f)\">改名</a-button>\n                    </div>\n                    <div>\n                      <label class=\"text-lg cursor-pointer\" :for=\"`f-${f.id}`\">选择</label>\n                      <a-checkbox :id=\"`f-${f.id}`\" :value=\"f.id\"></a-checkbox>\n                    </div>\n                  </div>\n                </div>\n              </a-col>\n            </a-row>\n          </a-checkbox-group>\n\n        </div>\n        <a-pagination\n            class=\"mt-3\"\n            v-model:current-page=\"pageForm.currentPage\"\n            v-model:page-size=\"pageForm.pageSize\"\n            :page-sizes=\"[24,48,96]\"\n            :background=\"true\"\n            layout=\"total, sizes, prev, pager, next, jumper\"\n            :total=\"total\"\n            @change=\"handleSizeChange\"\n            :show-total=\"total => `共 ${total} 条`\"\n        />\n      </a-col>\n\n    </a-row>\n  </div>\n</template>\n\n<script setup>\nimport {ref} from \"vue\";\nimport {Modal} from 'ant-design-vue';\nimport Api from \"@/api\"\nimport FileUpload from \"@/components/file-manager/FileUpload.vue\";\n\n\nconst setPid = (f) => {\n  pageForm.value.cid = f.id\n  loadFolderData()\n}\nconst baseApiUrl = import.meta.env.VITE_API_URL ? import.meta.env.VITE_API_URL : '';\n\nconst props = defineProps({\n  folders: Array,\n});\n\nconst total = ref(0)\nconst pageForm = ref({\n  name: \"\",\n  cid: 0,\n  currentPage: 1,\n  pageSize: 24,\n})\nconst files = ref([]);\nconst myFolders = ref([])\nwatch(() => props.folders, (val) => {\n  myFolders.value = val\n}, {immediate: true, deep: true})\n\nconst searchBy = () => {\n  loadFolderData()\n}\n\n\nconst handleSizeChange = async (e) => {\n  pageForm.value.currentPage = e\n  let response = await Api.fileController.index(pageForm.value)\n  files.value = response.data\n  total.value = response.total\n  pageForm.value.currentPage = response.meta?.current_page\n};\n\n\n// 上传文件显示\nconst uploadVisible = ref(false)\n//分类id\n\nwatch(() => uploadVisible, (val) => {\n  if (!val) {\n    //继续向上传递\n    console.log(\"==================\", val)\n  }\n})\n\nconst emit = defineEmits(['open-folder', 'delete-folder', 'download-file', 'delete-file']);\nconst del_obj = ref({\n  del_ids: []\n})\n\nconst loadFolderData = async () => {\n  let response = await Api.fileController.index(pageForm.value)\n  files.value = response.data\n  total.value = response.total\n  pageForm.value.currentPage = response.meta?.current_page\n}\n\nconst changeName = async (f) => {\n  await Api.fileController.update({id: f.id}, f)\n}\n\n\nconst delBatch = async () => {\n  Modal.confirm({\n    content: '删除所有',\n    async onOk() {\n      await Api.fileController.delBatch(del_obj.value)\n    },\n    cancelText: 'Click to destroy all',\n    onCancel() {\n      Modal.destroyAll();\n    },\n  });\n}\nconst showFile = async (path) => {\n  let url = `${baseApiUrl}/uploads/${path}`\n  let content = ``;\n  try {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n    const data = await response.text(); // 或 response.json()\n    console.log(data)\n    content = data;\n  } catch (error) {\n    console.error('Fetch error:', error);\n  }\n\n  Modal.info({\n    title: '查看文件',\n    content: content,\n    okText: '关闭',\n    cancelText: '取消',\n    width: '60%',\n    style: {\n      top: '20px',\n    },\n  })\n  // window.open(`http://localhost:3000/uploads/${path}`)\n}\n\ndefineExpose({\n  searchBy\n})\n</script>\n<style>\n.a-dropdown-link {\n  cursor: pointer;\n  color: #409EFF;\n}\n\n.a-icon-arrow-down {\n  font-size: 12px;\n}\n</style>\n","<template>\n  <div>\n    <a-modal v-model:visible=\"innerOpen\" title=\"创建文件夹\" @close=\"handleClose\" :maskClosable=\"false\">\n      <a-form :model=\"form\" laba-width=\"100px\" ref=\"formRef\">\n        <a-form-item label=\"父级\" name=\"pid\" has-feedback >\n          <a-select v-model:value=\"form.pid\">\n            <a-select-option label=\"\" v-for=\"(c,ind) in cates\" :key=\"ind\" :value=\"c.id\">\n              {{c.name}}\n            </a-select-option>\n          </a-select>\n        </a-form-item>\n        <a-form-item label=\"文件夹名称\" name=\"name\" has-feedback  :rules=\"[{ required: true, message: '请输入名称' }]\">\n          <a-input v-model:value=\"form.name\"></a-input>\n        </a-form-item>\n        <a-form-item label=\"文件类型\" name=\"type\" has-feedback  :rules=\"[{ required: true, message: '请选择类型' }]\">\n          <a-select v-model:value=\"form.type\">\n            <a-select-option value=\"\">请选择</a-select-option>\n            <a-select-option value=\"image\">图片</a-select-option>\n            <a-select-option value=\"video\">视频</a-select-option>\n            <a-select-option value=\"audio\">音频</a-select-option>\n            <a-select-option value=\"file\">文件</a-select-option>\n          </a-select>\n        </a-form-item>\n      </a-form>\n      <template #footer>\n        <a-button @click=\"handleClose\">取消</a-button>\n        <a-button type=\"primary\" @click=\"handleCreate\">创建</a-button>\n      </template>\n    </a-modal>\n  </div>\n</template>\n\n<script setup>\nimport {ref} from 'vue';\nimport Api from \"@/api\"\nimport {message as $message} from \"ant-design-vue\";\nconst formRef=ref()\nconst createFolder = async () => {\n  await Api.fileCateController.store(form.value)\n}\n\nconst cates = ref([])\nconst loadCate = async () => {\n  const {data} = await Api.fileCateController.list()\n  cates.value = data;\n}\nconst props = defineProps({\n  modelValue: Boolean\n});\nconst innerOpen = ref(props.modelValue);\n\nwatch(() => props.modelValue, (val) => {\n  innerOpen.value = val;\n  console.log(\"watch\", innerOpen.value)\n}, {immediate: true})\nconst emit = defineEmits(['update:modelValue', 'success']);\n\nconst form = ref({\n  pid: null,\n  name: '',\n  type: ''\n});\n\nconst handleCreate = async () => {\n\n  formRef.value?.validateFields().then(async (res) => {\n        console.log(\"res\",res)\n        await createFolder(form.value);\n        $message.error({content: \"成功\", key: \"success\"});\n        emit('success');\n        emit('update:modelValue', false);\n      })\n      .catch((e) => {\n        console.error(e);\n      })\n      .finally(() => {\n      });\n\n};\n\nconst handleClose = () => {\n  emit('update:modelValue', false);\n};\n</script>\n","<template>\n  <div>\n      <a-space>\n        <a-button-group>\n            <a-button type=\"primary\" @click=\"handleCreateFolder\">创建文件夹</a-button>\n        </a-button-group>\n      </a-space>\n\n      <a-row>\n        <a-col :span=\"24\">\n          <FileList :folders=\"folders\"  @refresh=\"fetchData\" ref=\"fileListRef\" />\n        </a-col>\n      </a-row>\n      <FoldCreate v-model=\"folderCreateVisible\" @success=\"fetchData\" @resetVisible=\"resetVisible\" />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted } from 'vue';\nimport FileList from '@/components/file-manager/FileList.vue';\nimport FoldCreate from '@/components/file-manager/FoldCreate.vue';\nimport Api from \"@/api\"\nconst folders = ref([]);\nconst getFolders = async ()=>{\n  folders.value = await Api.fileCateController.list()\n}\nconst fileListRef=ref(null)\nconst uploadVisible = ref(false);\nconst folderCreateVisible = ref(false);\n\n// 获取文件和文件夹数据\nconst fetchData = async () => {\n  await getFolders();\n  fileListRef.value.searchBy();\n};\n\n\n\n// 打开创建文件夹弹窗\nconst handleCreateFolder = () => {\n  folderCreateVisible.value = true;\n};\n\nconst resetVisible = () => {\n  uploadVisible.value = false;\n  folderCreateVisible.value = false;\n};\n\n// 初始化时加载数据\nonMounted(() => {\n  fetchData();\n});\n\nconst open = ref<boolean>(false);\n\nconst showModal = () => {\n  open.value = true;\n};\n\nconst handleOk = (e: MouseEvent) => {\n  console.log(e);\n  open.value = false;\n};\n</script>\n"],"names":["ref","handleChange","info","status","message","headers","props","__props","fileList","myFolders","emit","__emit","innerVisible","watch","val","my_id","changeCate","e","handleClose","setPid","f","pageForm","loadFolderData","baseApiUrl","total","files","searchBy","handleSizeChange","response","Api","_a","uploadVisible","del_obj","changeName","delBatch","Modal","showFile","path","url","content","data","error","__expose","formRef","createFolder","form","cates","innerOpen","handleCreate","res","$message","folders","getFolders","fileListRef","folderCreateVisible","fetchData","handleCreateFolder","resetVisible","onMounted"],"mappings":"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"}