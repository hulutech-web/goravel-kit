{"version":3,"file":"FileSelect.vue_vue_type_script_setup_true_lang.c8ce7069.1753605037589.js","sources":["../../src/components/file-select/FList.vue","../../src/components/file-select/FileSelect.vue"],"sourcesContent":["<template>\n  <div>\n    <a-row>\n      <a-col :span=\"6\">\n        <div>\n          <a-divider size=\"small\">\n            <span class=\"text-sm\">文件夹</span>\n          </a-divider>\n          <div v-for=\"(f,ind) in myFolders\" :key=\"ind\" @click=\"setPid(f)\"\n               class=\"flex h-12 w-full cursor-pointer text-sky-400 border border-solid border-gray-200 px-3 py-4\">\n            {{ f.name }}\n          </div>\n        </div>\n      </a-col>\n      <a-col :span=\"18\">\n        <a-space>\n          <a-input placeholder=\"请输入内容\" v-model:value=\"pageForm.name\" style=\"width:400px;\">\n          </a-input>\n          <a-button type=\"primary\" danger @click=\"searchBy\">搜索</a-button>\n          <a-button type=\"primary\" plain @click=\"pageForm.name=''\">清空</a-button>\n        </a-space>\n        <div class=\"border border-solid border-stone-200\">\n          <a-radio-group v-model:value=\"file\" class=\"min-h-[500px] mt-2\" style=\"width: 100%\">\n            <a-row :gutter=\"[32,64]\">\n              <a-col :span=\"3\" v-for=\"(f,ind) in files\" :key=\"ind\">\n                <div class=\"w-[80px] h-[80px] text-center\" style=\"border: .5px dotted #e5e7eb;\">\n                  <a-image\n                      v-if=\"f.type==='image'\"\n                      ref=\"imageRef\"\n                      :height=\"80\"\n                      style=\"height:80px;object-fit: cover;\"\n                      :src=\"`${baseApiUrl}${f.uri}`\"\n                      :preview-src-list=\"[`${baseApiUrl}${f.uri}`]\"\n                  />\n                  <file-filled @click=\"showFile(f.path)\" :height=\"'80px'\" :width=\"'80px'\"\n                               style=\"width: 80px; height: 80px;font-size:80px;color:#e6a23c\" v-else/>\n                  <div class=\"text-center font-light text-xs text-blue-400\">\n                    <div class=\"flex\">\n                      <a-input\n                          class=\"flex-1\"\n                          ref=\"inputRef\"\n                          v-model:value=\"f.name\"\n                          type=\"text\"\n                          size=\"small\"\n                          disabled\n                          :style=\"{ width: '100%',color:'grey' }\"\n                      />\n                    </div>\n                    <div>\n                      <label class=\"text-lg cursor-pointer\" :for=\"`f-${f.id}`\">选择</label>\n                      <a-radio :id=\"`f-${f.id}`\" :value=\"f\"></a-radio>\n                    </div>\n                  </div>\n                </div>\n              </a-col>\n            </a-row>\n          </a-radio-group>\n\n        </div>\n        <a-pagination\n            class=\"mt-3\"\n            v-model:current-page=\"pageForm.currentPage\"\n            v-model:page-size=\"pageForm.pageSize\"\n            :page-sizes=\"[24,48,96]\"\n            :background=\"true\"\n            layout=\"total, sizes, prev, pager, next, jumper\"\n            :total=\"total\"\n            @change=\"handleSizeChange\"\n            :show-total=\"total => `共 ${total} 条`\"\n        />\n      </a-col>\n\n    </a-row>\n  </div>\n</template>\n\n<script setup>\nimport {ref} from \"vue\";\nimport {Modal} from 'ant-design-vue';\nimport Api from \"@/api\"\n\nconst file = ref(null)\n\nconst setPid = (f) => {\n  pageForm.value.cid = f.id\n  loadFolderData()\n}\nconst baseApiUrl = import.meta.env.VITE_API_URL ? import.meta.env.VITE_API_URL : '';\n\nconst props = defineProps({\n  folders: Array,\n});\n\nconst total = ref(0)\nconst pageForm = ref({\n  name: \"\",\n  cid: 0,\n  currentPage: 1,\n  pageSize: 24,\n})\nconst files = ref([]);\nconst myFolders = ref([])\nwatch(() => props.folders, (val) => {\n  myFolders.value = val\n}, {immediate: true, deep: true})\n\nconst searchBy = () => {\n  loadFolderData()\n}\n\n\nconst handleSizeChange = async (e) => {\n  pageForm.value.currentPage = e\n  let response = await Api.fileController.index(pageForm.value)\n  files.value = response.data\n  total.value = response.total\n  pageForm.value.currentPage = response.meta?.current_page\n};\n\n\n// 上传文件显示\nconst uploadVisible = ref(false)\n//分类id\n\nwatch(() => uploadVisible, (val) => {\n  if (!val) {\n    //继续向上传递\n    console.log(\"==================\", val)\n  }\n})\n\nconst emit = defineEmits(['open-folder', 'delete-folder', 'download-file', 'delete-file']);\n\nconst loadFolderData = async () => {\n  let response = await Api.fileController.index(pageForm.value)\n  files.value = response.data\n  total.value = response.total\n  pageForm.value.currentPage = response.meta?.current_page\n}\n\nconst changeName = async (f) => {\n  await Api.fileController.update({id: f.id}, f)\n}\n\n\nconst showFile = async (path) => {\n  let url = `${baseApiUrl}/uploads/${path}`\n  let content = ``;\n  try {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n    const data = await response.text(); // 或 response.json()\n    console.log(data)\n    content = data;\n  } catch (error) {\n    console.error('Fetch error:', error);\n  }\n\n  Modal.info({\n    title: '查看文件',\n    content: content,\n    okText: '关闭',\n    cancelText: '取消',\n    width: '60%',\n    style: {\n      top: '20px',\n    },\n  })\n  // window.open(`http://localhost:3000/uploads/${path}`)\n}\n\nconst getFile = () => {\n  return file.value\n}\ndefineExpose({\n  getFile,\n  searchBy\n})\n\n</script>\n<style>\n.a-dropdown-link {\n  cursor: pointer;\n  color: #409EFF;\n}\n\n.a-icon-arrow-down {\n  font-size: 12px;\n}\n</style>\n","<template>\r\n  <div>\r\n    <slot name=\"default\">\r\n      <a-space>\r\n        <a-button @click=\"showModal\" size=\"small\">\r\n          <cloud-upload-outlined/>\r\n          选择\r\n        </a-button>\r\n        <span class=\"text-sm text-sky-500\" style=\"word-break: break-all;\">{{ file.name }}</span>\r\n      </a-space>\r\n    </slot>\r\n    <a-row>\r\n      <a-col :span=\"24\">\r\n        <a-modal v-model:visible=\"visible\" title=\"上传文件\" @ok=\"getFile\" @cancel=\"handleClose\"\r\n                 style=\"width:1200px;top: 20px\"\r\n                 :maskClosable=\"false\" :center=\"true\">\r\n          <FList ref=\"fileRef\" :folders=\"folders\" @refresh=\"fetchData\"/>\r\n        </a-modal>\r\n      </a-col>\r\n    </a-row>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport {ref} from 'vue';\r\nimport FList from '@/components/file-select/FList.vue';\r\nimport Api from \"@/api\"\r\n\r\n\r\nconst props = defineProps({\r\n  modelValue: String,\r\n})\r\nconst uri = ref(props.modelValue)\r\nconst file = ref({\r\n  id: null,\r\n  uri: \"\",\r\n  name: \"\"\r\n})\r\nconst folders = ref([]);\r\nconst visible = ref(false);\r\nconst handleClose = () => {\r\n}\r\nconst getFolders = async () => {\r\n  folders.value = await Api.fileCateController.list()\r\n}\r\nconst fileRef = ref(null)\r\nconst uploadVisible = ref(false);\r\nconst folderCreateVisible = ref(false);\r\n\r\n// 获取文件和文件夹数据\r\nconst fetchData = async () => {\r\n  await getFolders();\r\n};\r\nconst emit = defineEmits(['update:modelValue'])\r\nconst getFile = () => {\r\n  file.value = fileRef.value.getFile()\r\n  uri.value = file.value.uri\r\n  emit('update:modelValue', file.value.uri)\r\n  visible.value = false\r\n  return file.value\r\n}\r\n\r\n\r\nwatch(visible, (val) => {\r\n  if (val) {\r\n    fetchData()\r\n  }\r\n})\r\n\r\nconst open = ref<boolean>(false);\r\n\r\nconst showModal = () => {\r\n  visible.value = true;\r\n  nextTick(() => {\r\n    fileRef.value.searchBy();\r\n  })\r\n};\r\ndefineExpose({\r\n  showModal,\r\n});\r\nconst handleOk = (e: MouseEvent) => {\r\n  console.log(e);\r\n  open.value = false;\r\n};\r\n</script>\r\n"],"names":["file","ref","setPid","f","pageForm","loadFolderData","baseApiUrl","props","__props","total","files","myFolders","watch","val","searchBy","handleSizeChange","e","response","Api","_a","uploadVisible","showFile","path","url","content","data","error","Modal","__expose","uri","folders","visible","handleClose","getFolders","fileRef","fetchData","emit","__emit","getFile","showModal","nextTick"],"mappings":"2sBAiFA,MAAAA,EAAAC,EAAA,IAAA,EAEAC,EAAAC,GAAA,CACAC,EAAA,MAAA,IAAAD,EAAA,GACAE,EAAA,CACA,EACAC,EAAA,sBAEAC,EAAAC,EAIAC,EAAAR,EAAA,CAAA,EACAG,EAAAH,EAAA,CACA,KAAA,GACA,IAAA,EACA,YAAA,EACA,SAAA,EACA,CAAA,EACAS,EAAAT,EAAA,CAAA,CAAA,EACAU,EAAAV,EAAA,EAAA,EACAW,EAAA,IAAAL,EAAA,QAAAM,GAAA,CACAF,EAAA,MAAAE,CACA,EAAA,CAAA,UAAA,GAAA,KAAA,EAAA,CAAA,EAEA,MAAAC,EAAA,IAAA,CACAT,EAAA,CACA,EAGAU,EAAA,MAAAC,GAAA,OACAZ,EAAA,MAAA,YAAAY,EACA,IAAAC,EAAA,MAAAC,EAAA,eAAA,MAAAd,EAAA,KAAA,EACAM,EAAA,MAAAO,EAAA,KACAR,EAAA,MAAAQ,EAAA,MACAb,EAAA,MAAA,aAAAe,EAAAF,EAAA,OAAA,YAAAE,EAAA,YACA,EAIAC,EAAAnB,EAAA,EAAA,EAGAW,EAAA,IAAAQ,EAAAP,GAAA,CACAA,GAEA,QAAA,IAAA,qBAAAA,CAAA,CAEA,CAAA,EAIA,MAAAR,EAAA,SAAA,OACA,IAAAY,EAAA,MAAAC,EAAA,eAAA,MAAAd,EAAA,KAAA,EACAM,EAAA,MAAAO,EAAA,KACAR,EAAA,MAAAQ,EAAA,MACAb,EAAA,MAAA,aAAAe,EAAAF,EAAA,OAAA,YAAAE,EAAA,YACA,EAOAE,EAAA,MAAAC,GAAA,CACA,IAAAC,EAAA,GAAAjB,CAAA,YAAAgB,CAAA,GACAE,EAAA,GACA,GAAA,CACA,MAAAP,EAAA,MAAA,MAAAM,CAAA,EACA,GAAA,CAAAN,EAAA,GACA,MAAA,IAAA,MAAA,uBAAAA,EAAA,MAAA,EAAA,EAEA,MAAAQ,EAAA,MAAAR,EAAA,OACA,QAAA,IAAAQ,CAAA,EACAD,EAAAC,CACA,OAAAC,EAAA,CACA,QAAA,MAAA,eAAAA,CAAA,CACA,CAEAC,EAAA,KAAA,CACA,MAAA,OACA,QAAAH,EACA,OAAA,KACA,WAAA,KACA,MAAA,MACA,MAAA,CACA,IAAA,MACA,CACA,CAAA,CAEA,EAKA,OAAAI,EAAA,CACA,QAJA,IACA5B,EAAA,MAIA,SAAAc,CACA,CAAA,0mFCnJA,MAAAe,EAAA5B,EAHAO,EAGA,UAAA,EACAR,EAAAC,EAAA,CAAiB,GAAA,KACX,IAAA,GACC,KAAA,EACC,CAAA,EAER6B,EAAA7B,EAAA,CAAA,CAAA,EACA8B,EAAA9B,EAAA,EAAA,EACA+B,EAAA,IAAA,CAA0B,EAE1BC,EAAA,SAAA,CACEH,EAAA,MAAA,MAAAZ,EAAA,mBAAA,KAAA,CAAkD,EAEpDgB,EAAAjC,EAAA,IAAA,EACAA,EAAA,EAAA,EACAA,EAAA,EAAA,EAGA,MAAAkC,EAAA,SAAA,CACE,MAAAF,EAAA,CAAiB,EAEnBG,EAAAC,EACAC,EAAA,KACEtC,EAAA,MAAAkC,EAAA,MAAA,QAAA,EACAL,EAAA,MAAA7B,EAAA,MAAA,IACAoC,EAAA,oBAAApC,EAAA,MAAA,GAAA,EACA+B,EAAA,MAAA,GACA/B,EAAA,OAIFY,EAAAmB,EAAAlB,GAAA,CACEA,GACEsB,GACF,CAAA,EAGFlC,EAAA,EAAA,EAEA,MAAAsC,EAAA,IAAA,CACER,EAAA,MAAA,GACAS,GAAA,IAAA,CACEN,EAAA,MAAA,UAAuB,CAAA,CACxB,EAEH,OAAAN,EAAA,CAAa,UAAAW,CACX,CAAA;;"}