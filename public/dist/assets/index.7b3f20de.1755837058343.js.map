{"version":3,"file":"index.7b3f20de.1755837058343.js","sources":["../../src/components/file-select/FList.vue","../../src/components/file-select/FileSelect.vue","../../src/pages/system/user/index.vue"],"sourcesContent":["<template>\n  <div>\n    <a-row>\n      <a-col :span=\"6\">\n        <a-table size=\"small\" :data-source=\"myFolders\" :columns=\"columns\" style=\"width: 100%\" bordered>\n          <template #bodyCell=\"{ column, record }\">\n            <template v-if=\"column.dataIndex === 'name'\">\n              <a-button type=\"link\" @click=\"loadFolderData(record.id)\">{{ record.name }}</a-button>\n            </template>\n          </template>\n        </a-table>\n      </a-col>\n      <a-col :span=\"18\">\n        <a-space>\n          <a-input placeholder=\"请输入内容\" v-model=\"keyword\" style=\"width:400px;\">\n          </a-input>\n          <a-button type=\"primary\" danger @click=\"searchBy\">搜索</a-button>\n          <a-button type=\"primary\" plain @click=\"keyword=''\">清空</a-button>\n        </a-space>\n        <div class=\"border border-solid border-stone-200\">\n          <a-radio-group v-model:value=\"file\" class=\"min-h-[500px] mt-2\" style=\"width: 100%\">\n            <a-row :gutter=\"[32,64]\">\n              <a-col :span=\"3\" v-for=\"(f,ind) in files\" :key=\"ind\">\n                <div class=\"w-[80px] h-[80px] text-center\" style=\"border: .5px dotted #e5e7eb;\">\n                  <a-image\n                      v-if=\"f.type==='image'\"\n                      ref=\"imageRef\"\n                      :height=\"80\"\n                      style=\"height:80px;object-fit: cover;\"\n                      :src=\"`${baseApiUrl}/uploads/${f.path}`\"\n                      :preview-src-list=\"[`${baseApiUrl}/uploads/${f.path}`]\"\n                  />\n                  <file-filled @click=\"showFile(f.path)\" :height=\"'80px'\" :width=\"'80px'\"\n                               style=\"width: 80px; height: 80px;font-size:80px;color:#e6a23c\" v-else/>\n                  <div class=\"text-center font-light text-xs text-blue-400\">\n                    <div class=\"flex\">\n                      <a-input\n                          class=\"flex-1\"\n                          ref=\"inputRef\"\n                          v-model:value=\"f.name\"\n                          type=\"text\"\n                          size=\"small\"\n                          disabled\n                          :style=\"{ width: '100%',color:'grey' }\"\n                      />\n                    </div>\n                    <div>\n                      <label class=\"text-lg cursor-pointer\" :for=\"`f-${f.id}`\">选择</label>\n                      <a-radio :id=\"`f-${f.id}`\" :value=\"f\"></a-radio>\n                    </div>\n                  </div>\n                </div>\n              </a-col>\n            </a-row>\n          </a-radio-group>\n\n        </div>\n        <a-pagination\n            class=\"mt-3\"\n            v-model:current-page=\"pageForm.page\"\n            v-model:page-size=\"pageForm.page_size\"\n            :page-sizes=\"[24,48,96]\"\n            :background=\"true\"\n            layout=\"total, sizes, prev, pager, next, jumper\"\n            :total=\"pageForm.total\"\n            @change=\"handleSizeChange\"\n        />\n      </a-col>\n\n    </a-row>\n  </div>\n</template>\n\n<script setup>\nimport {ref} from \"vue\";\nimport {Modal} from 'ant-design-vue';\nimport Api from \"@/api\"\n\nconst columns = [\n  {\n    title: '名称',\n    dataIndex: 'name',\n    key: 'name',\n  },\n]\nconst baseApiUrl = import.meta.env.VITE_API_URL?import.meta.env.VITE_API_URL:'';\n\n\nconst props = defineProps({\n  folders: Array,\n});\nconst pageForm = ref({\n  page: 1,\n  total: 0,\n  page_size: 24,\n})\nconst files = ref([]);\nconst myFolders = ref([])\nwatch(() => props.folders, (val) => {\n  myFolders.value = val\n}, {immediate: true, deep: true})\n\nconst fold_id = ref(\"\")\nconst keyword = ref(\"\")\nconst searchBy = () => {\n  loadFolderData()\n}\n\n\nconst handleSizeChange = async (e) => {\n  let response = await Api.fileController.index({currentPage: e, pageSize: 24})\n  files.value = response.data\n  pageForm.value.total = response.total\n  pageForm.value.page = response.meta?.current_page\n};\n\nconst handleCurrentChange = (val) => {\n  pageForm.value.page = val;\n  loadFolderData()\n};\n// 上传文件显示\nconst uploadVisible = ref(false)\n//分类id\nconst cate_id = ref(null)\n// 上传文件\nconst handleUpload = (id) => {\n  uploadVisible.value = true\n  cate_id.value = id;\n}\n\nconst emit = defineEmits(['open-folder', 'delete-folder', 'download-file', 'delete-file']);\n\nconst file = ref({});\n\nconst loadFolderData = async (id) => {\n  if (id) {\n    const response = await Api.fileCateController.files({id: id})\n    files.value = response.data\n    pageForm.value.total = response.total\n    pageForm.value.page = response.meta?.current_page\n  } else {\n    let response = await Api.fileController.index({pageSize: 24})\n    files.value = response.data\n    pageForm.value.total = response.total\n    pageForm.value.page = response.meta?.current_page\n  }\n}\n\n\nconst handleOpenFolder = (id) => {\n  fold_id.value = id\n  loadFolderData(id)\n};\nconst fetchData = (val) => {\n  console.log(val)\n}\nconst handleDeleteFolder = (id) => {\n  emit('delete-folder', id);\n};\nconst getFile = () => {\n  return file.value\n}\ndefineExpose({\n  getFile,\n  searchBy\n})\n\nconst delBatch = async () => {\n  Modal.confirm({\n    content: '删除所有',\n    async onOk() {\n      await Api.fileController.delBatch(del_obj.value)\n    },\n    cancelText: 'Click to destroy all',\n    onCancel() {\n      Modal.destroyAll();\n    },\n  });\n}\nconst showFile = async (path) => {\n  let url = `/uploads/${path}`\n  let content = ``;\n  try {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n    const data = await response.text(); // 或 response.json()\n    console.log(data)\n    content = data;\n  } catch (error) {\n    console.error('Fetch error:', error);\n  }\n\n  Modal.info({\n    title: '查看文件',\n    content: content,\n    okText: '关闭',\n    cancelText: '取消',\n    width: '60%',\n    style: {\n      top: '20px',\n    },\n  })\n  // window.open(`http://localhost:3000/uploads/${path}`)\n}\n\n</script>\n<style>\n.a-dropdown-link {\n  cursor: pointer;\n  color: #409EFF;\n}\n\n.a-icon-arrow-down {\n  font-size: 12px;\n}\n</style>\n","<template>\r\n  <div>\r\n    <slot name=\"default\">\r\n      <a-space>\r\n        <a-button @click=\"showModal\" size=\"small\">\r\n          <cloud-upload-outlined/>\r\n          选择\r\n        </a-button>\r\n        <span class=\"text-sm text-sky-500\" style=\"word-break: break-all;\">{{ file.name }}</span>\r\n      </a-space>\r\n    </slot>\r\n    <a-row>\r\n      <a-col :span=\"24\">\r\n        <a-modal v-model:visible=\"visible\" title=\"上传文件\" @ok=\"getFile\" @cancel=\"handleClose\"\r\n                 style=\"width:1200px;top: 20px\"\r\n                 :maskClosable=\"false\" :center=\"true\">\r\n          <FList ref=\"fileRef\" :folders=\"folders\" @refresh=\"fetchData\"/>\r\n        </a-modal>\r\n      </a-col>\r\n    </a-row>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport {ref} from 'vue';\r\nimport FList from '@/components/file-select/FList.vue';\r\nimport Api from \"@/api\"\r\n\r\n\r\nconst props = defineProps({\r\n  modelValue: String,\r\n})\r\nconst uri = ref(props.modelValue)\r\nconst file = ref({\r\n  id: null,\r\n  uri: \"\",\r\n  name: \"\"\r\n})\r\nconst folders = ref([]);\r\nconst visible = ref(false);\r\nconst handleClose = () => {\r\n}\r\nconst getFolders = async () => {\r\n  folders.value = await Api.fileCateController.list()\r\n}\r\nconst fileRef = ref(null)\r\nconst uploadVisible = ref(false);\r\nconst folderCreateVisible = ref(false);\r\n\r\n// 获取文件和文件夹数据\r\nconst fetchData = async () => {\r\n  await getFolders();\r\n};\r\nconst emit = defineEmits(['update:modelValue'])\r\nconst getFile = () => {\r\n  file.value = fileRef.value.getFile()\r\n  uri.value = file.value.uri\r\n  emit('update:modelValue', file.value.uri)\r\n  visible.value = false\r\n  return file.value\r\n}\r\n\r\n\r\nwatch(visible, (val) => {\r\n  if (val) {\r\n    fetchData()\r\n  }\r\n})\r\n\r\nconst open = ref<boolean>(false);\r\n\r\nconst showModal = () => {\r\n  visible.value = true;\r\n  nextTick(() => {\r\n    fileRef.value.searchBy();\r\n  })\r\n};\r\ndefineExpose({\r\n  showModal,\r\n});\r\nconst handleOk = (e: MouseEvent) => {\r\n  console.log(e);\r\n  open.value = false;\r\n};\r\n</script>\r\n","<script lang=\"ts\" setup>\nimport {ref} from 'vue'\nimport {message} from 'ant-design-vue'\nimport type {VxeGridListeners} from 'vxe-table'\nimport useUser from \"./index.ts\"\nimport Api from \"@/api\";\n\nconst router = useRouter();\nconst {gridOptions} = useUser()\nconst xGrid = ref()\nconst serveApiUrl = import.meta.env.VITE_API_URL;\n\n// 编辑用户\nconst editCourse = (row: any) => {\n  const grid = xGrid.value\n  grid.setEditRow(row)\n}\n\n\n\n\nconst gridEvent: VxeGridListeners = {\n  proxyQuery() {\n    //设置column为cover的列，将其数据设置为数组，数组形式如下：[{name:'xx',url:'xx'}...]\n  },\n}\n\n\nconst fileRef = ref(null)\nconst selectFile = () => {\n  fileRef.value.showModal()\n  //通过xGrid获取到row的列，并且把cover数据改为\n}\n\nconst toChapter = (row) => {\n  router.push({path: `/course/${row.id}/chapter`})\n}\n</script>\n\n<template>\n  <div class=\"demo-page-wrapper\">\n    <vxe-grid\n        ref=\"xGrid\"\n        v-bind=\"gridOptions\"\n        v-on=\"gridEvent\"\n    >\n\n      <template #avatar=\"{ row }\">\n        <a-space>\n          <vxe-image :src=\"`${serveApiUrl}/uploads/${row.avatar}`\" width=\"64\" height=\"64\"></vxe-image>\n          <FileSelect ref=\"fileRef\" v-model=\"row.avatar\">\n          </FileSelect>\n        </a-space>\n      </template>\n      <template #action=\"{ row }\">\n        <a-space>\n          <a-popconfirm\n              title=\"确认删除吗？\"\n              ok-text=\"是\"\n              cancel-text=\"否\"\n              @confirm=\"delCourse(row)\"\n          >\n            <a-button size=\"small\" type=\"primary\" danger>删除</a-button>\n          </a-popconfirm>\n          <a-button type=\"primary\" size=\"small\" @click=\"toChapter(row)\">章节</a-button>\n        </a-space>\n      </template>\n    </vxe-grid>\n  </div>\n</template>\n\n<style scoped lang=\"less\">\n.demo-page-wrapper {\n  padding: 20px;\n}\n</style>"],"names":["columns","baseApiUrl","props","__props","pageForm","ref","files","myFolders","watch","val","keyword","searchBy","loadFolderData","handleSizeChange","e","response","Api","_a","file","id","_b","__expose","showFile","path","url","content","data","error","Modal","uri","folders","visible","handleClose","getFolders","fileRef","fetchData","emit","__emit","getFile","showModal","nextTick","router","useRouter","gridOptions","useUser","xGrid","serveApiUrl","gridEvent","toChapter","row"],"mappings":"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"}