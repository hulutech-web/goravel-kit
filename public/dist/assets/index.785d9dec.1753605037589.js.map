{"version":3,"file":"index.785d9dec.1753605037589.js","sources":["../../src/pages/system/user/index.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport {ref} from 'vue'\nimport {message} from 'ant-design-vue'\nimport type {VxeGridListeners} from 'vxe-table'\nimport useUser from \"./index.ts\"\nimport Api from \"@/api\"\nconst router = useRouter();\nconst {gridOptions} = useUser()\nconst xGrid = ref()\nconst serveApiUrl = import.meta.env.VITE_API_URL;\n\n\nconst gridEvent: VxeGridListeners = {\n  proxyQuery() {\n  },\n}\n\nconst fileList = ref([]);\nconst currentFile = ref(null)\n\nconst courseOptions = ref([])\nconst uploading = ref<boolean>(false);\n\nconst handleChange = (info) => {\n  const status = info.file.status;\n  if (status !== 'uploading') {\n    // console.log(info.file, info.fileList);\n  }\n  if (status === 'done') {\n    message.success(`${info.file.name} 上传成功.`);\n    fileList.value = [];\n    console.log(info.file.response)\n  } else if (status === 'error') {\n    message.error(`${info.file.name} 上传失败.`);\n  }\n  if (info.file.status === 'done') {\n    // 替换当前上传文件列表为最新的上传成功的文件\n  } else if (info.file.status === 'removed') {\n    // 如果文件被移除，则清空当前文件\n  }\n};\n\nconst open = ref(false)\nconst addCourseTemplate = (user) => {\n  open.value = true;\n  formState.value.user_id=user.id;\n  loadOptions()\n}\nconst cancel = () => {\n  open.value = false;\n}\n\nconst handleOk = () => {\n\n}\n\ninterface Domain {\n  course_id: number;\n  remain_num: number;\n}\n\n// 表单数据\nconst formRef = ref();\n\n\nconst loadOptions= async ()=>{\n  courseOptions.value =  await Api.courseController.option()\n}\nconst formState = ref({\n  user_id:null,\n  user_coupon_templates:[]\n})\nconst dynamicValidateForm = reactive<{ domains: Domain[] }>({\n  domains: [\n    {\n      course_id: null,\n      remain_num: 0,\n    }\n  ],\n});\nconst submitForm =  () => {\n  formRef.value\n      .validate()\n      .then(async() => {\n        console.log('values', dynamicValidateForm.domains);\n        formState.value = {\n          ...formState.value,\n          user_coupon_templates: dynamicValidateForm.domains\n        }\n        console.log(formState.value)\n        await Api.userCouponTemplateController.makeup(formState.value)\n      })\n      .catch(error => {\n        console.log('error', error);\n      });\n};\nconst resetForm = () => {\n  formRef.value.resetFields();\n};\nconst removeDomain = (item: Domain) => {\n  let index = dynamicValidateForm.domains.indexOf(item);\n  if (index !== -1) {\n    dynamicValidateForm.domains.splice(index, 1);\n  }\n};\nconst addDomain = () => {\n  dynamicValidateForm.domains.push({\n    course_id: null,\n    remain_num: 0,\n  });\n};\n\n\n</script>\n\n<template>\n  <div>\n    <a-modal v-model:visible=\"open\" title=\"学员补课\" :footer=\"false\" :width=\"900\">\n      <a-form\n          ref=\"formRef\"\n          name=\"dynamic_form_item\"\n          :model=\"dynamicValidateForm\"\n      >\n        <div v-for=\"(domain, index) in dynamicValidateForm.domains\" class=\"flex justify-between items-center\" :key=\"index\">\n              <a-form-item\n                  label=\"课程\"\n                  :name=\"['domains', index, 'course_id']\"\n                  style=\"flex:3;margin:12px;\"\n                  :rules=\"{\n                      required: true,\n                      message: '课程不为空',\n                      trigger: 'change',\n                    }\"\n              >\n                  <a-select  v-model:value=\"domain.course_id\" show-search>\n                    <a-select-option  v-for=\"(la,ind) in courseOptions\" :key=\"ind\" :value=\"la.value\">{{la.label}} 教练：{{la.coach_name}}【共{{la.times}}节】</a-select-option>\n                  </a-select>\n\n              </a-form-item>\n\n\n          <a-form-item\n              label=\"剩余节数\"\n              :name=\"['domains', index, 'remain_num']\"\n              style=\"flex:2;margin:12px;\"\n              :rules=\"{\n                      required: true,\n                      message: '剩余节数不为空',\n                      trigger: 'change',\n                    }\"\n          >\n            <a-input-number\n                v-model:value=\"domain.remain_num\"\n                placeholder=\"节数\"\n            />\n\n          </a-form-item>\n          <MinusCircleOutlined\n              style=\"font-size: 24px;flex:1;margin-bottom:8px;\"\n              v-if=\"dynamicValidateForm.domains.length > 1\"\n              :disabled=\"dynamicValidateForm.domains.length === 1\"\n              @click=\"removeDomain(domain)\"\n          />\n        </div>\n\n        <a-form-item>\n          <a-button type=\"dashed\" style=\"width: 60%\" @click=\"addDomain\">\n            <PlusOutlined/>\n            添加\n          </a-button>\n        </a-form-item>\n        <a-form-item>\n          <a-button type=\"primary\" html-type=\"submit\" @click=\"submitForm\">提交</a-button>\n          <a-button style=\"margin-left: 10px\" @click=\"resetForm\">Reset</a-button>\n        </a-form-item>\n      </a-form>\n    </a-modal>\n    <vxe-grid\n        ref=\"xGrid\"\n        v-bind=\"gridOptions\"\n        v-on=\"gridEvent\"\n    >\n\n      <template #avatar=\"{ row }\">\n        <a-space>\n          <vxe-image :src=\"`${serveApiUrl}${row.avatar}`\" width=\"64\" height=\"64\"></vxe-image>\n          <FileSelect ref=\"fileRef\" v-model=\"row.avatar\">\n          </FileSelect>\n        </a-space>\n      </template>\n      <template #action=\"{ row }\">\n        <a-button type=\"primary\" size=\"small\" @click=\"addCourseTemplate(row)\">学员补课</a-button>\n      </template>\n    </vxe-grid>\n  </div>\n</template>\n\n<style scoped lang=\"less\">\n.demo-page-wrapper {\n  padding: 20px;\n}\n</style>"],"names":["useRouter","gridOptions","useUser","xGrid","ref","serveApiUrl","gridEvent","courseOptions","open","addCourseTemplate","user","formState","loadOptions","formRef","Api","dynamicValidateForm","reactive","submitForm","error","resetForm","removeDomain","item","index","addDomain"],"mappings":"g3FAMAA,GAAA,EACA,KAAA,CAAA,YAAAC,GAAAC,KACAC,EAAAC,IACAC,EAAA,sBAGAC,EAAA,CAAoC,YAAA,CACrB,CACb,EAGFF,EAAA,CAAA,CAAA,EACAA,EAAA,IAAA,EAEA,MAAAG,EAAAH,EAAA,CAAA,CAAA,EACAA,EAAA,EAAA,EAqBA,MAAAI,EAAAJ,EAAA,EAAA,EACAK,EAAAC,GAAA,CACEF,EAAA,MAAA,GACAG,EAAA,MAAA,QAAAD,EAAA,GACAE,GAAY,EAgBdC,EAAAT,IAGAQ,EAAA,SAAA,CACEL,EAAA,MAAA,MAAAO,EAAA,iBAAA,OAAA,CAAyD,EAE3DH,EAAAP,EAAA,CAAsB,QAAA,KACZ,sBAAA,CAAA,CACe,CAAA,EAEzBW,EAAAC,GAAA,CAA4D,QAAA,CACjD,CACP,UAAA,KACa,WAAA,CACC,CACd,CACF,CAAA,EAEFC,EAAA,IAAA,CACEJ,EAAA,MAAA,SAAA,EAAA,KAAA,SAAA,CAGM,QAAA,IAAA,SAAAE,EAAA,OAAA,EACAJ,EAAA,MAAA,CAAkB,GAAAA,EAAA,MACH,sBAAAI,EAAA,OAC8B,EAE7C,QAAA,IAAAJ,EAAA,KAAA,EACA,MAAAG,EAAA,6BAAA,OAAAH,EAAA,KAAA,CAA6D,CAAA,EAAA,MAAAO,GAAA,CAG7D,QAAA,IAAA,QAAAA,CAAA,CAA0B,CAAA,CAC3B,EAEPC,EAAA,IAAA,CACEN,EAAA,MAAA,aAA0B,EAE5BO,EAAAC,GAAA,CACE,IAAAC,EAAAP,EAAA,QAAA,QAAAM,CAAA,EACAC,IAAA,IACEP,EAAA,QAAA,OAAAO,EAAA,CAAA,CACF,EAEFC,EAAA,IAAA,CACER,EAAA,QAAA,KAAA,CAAiC,UAAA,KACpB,WAAA,CACC,CAAA,CACb;;"}