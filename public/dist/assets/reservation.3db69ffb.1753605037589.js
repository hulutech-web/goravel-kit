import{b as Y,l as W,g as Z,t as J,L as K,F as Q,i as X,n as ee,y as te,a5 as oe,K as ne}from"./ant-design-vue.00fd9e7c.1753605037589.js";import{_ as se}from"./index.vue_vue_type_script_setup_true_lang.44ffc11e.1753605037589.js";import{_ as re}from"./index.vue_vue_type_script_setup_true_lang.bc4af16c.1753605037589.js";import{d as le}from"./dayjs.d60d73bd.1753605037589.js";import{i as ie,a as ae,b as de,c as ue,d as me,l as pe,F as ce}from"./@fullcalendar.0fd6f4b3.1753605037589.js";import{A as T,a as ve}from"./index-a4f0172e.js";import{h as _e,d as O,b as fe,r as k,w as U,Z as S,_ as V,c as r,u,a3 as l,J as xe,I as i,a5 as $,$ as b,F as H,a7 as ye,a2 as B,a6 as R,j as z}from"./@vue.3ad65df9.1753605037589.js";import"./@babel.ff5fac95.1753605037589.js";import"./resize-observer-polyfill.0f9f8adb.1753605037589.js";import"./vue-types.ef06c517.1753605037589.js";import"./@ant-design.002a57d7.1753605037589.js";import"./@ctrl.110cde02.1753605037589.js";import"./dom-align.ecb06dd6.1753605037589.js";import"./lodash-es.3d27f5e2.1753605037589.js";import"./async-validator.dee29e8b.1753605037589.js";import"./scroll-into-view-if-needed.583c97c5.1753605037589.js";import"./compute-scroll-into-view.183f845a.1753605037589.js";import"./preact.30b9eaac.1753605037589.js";import"./moment.a515eed7.1753605037589.js";import"./vue-router.9360959a.1753605037589.js";import"./pinia.11f4bfaa.1753605037589.js";import"./vue-demi.71ba0ef2.1753605037589.js";import"./axios.dcb3bfcc.1753605037589.js";import"./qs.247a6393.1753605037589.js";import"./side-channel.9d8f1847.1753605037589.js";import"./es-errors.c75f5a96.1753605037589.js";import"./object-inspect.0fbacf7d.1753605037589.js";import"./side-channel-list.c76608c5.1753605037589.js";import"./side-channel-map.76c430fe.1753605037589.js";import"./get-intrinsic.7d53f00e.1753605037589.js";import"./es-object-atoms.11ea1ab9.1753605037589.js";import"./math-intrinsics.9389030e.1753605037589.js";import"./gopd.30775706.1753605037589.js";import"./es-define-property.27915812.1753605037589.js";import"./has-symbols.76fb15e9.1753605037589.js";import"./get-proto.757e385d.1753605037589.js";import"./dunder-proto.05150bcd.1753605037589.js";import"./call-bind-apply-helpers.0833f3e9.1753605037589.js";import"./function-bind.61637ca6.1753605037589.js";import"./hasown.67f3f833.1753605037589.js";import"./call-bound.09054f06.1753605037589.js";import"./side-channel-weakmap.4b9abb6a.1753605037589.js";import"./stepin.df3b4e80.1753605037589.js";import"./enquire.js.29d23a08.1753605037589.js";import"./lodash.5999789d.1753605037589.js";import"./js-cookie.df2f1d76.1753605037589.js";import"./@vueuse.60746e97.1753605037589.js";import"./clipboard.f49c93fb.1753605037589.js";import"./highlight.js.1f23b1ae.1753605037589.js";import"./nprogress.dafb99c9.1753605037589.js";import"./vxe-table.a5304289.1753605037589.js";import"./xe-utils.0b26132f.1753605037589.js";import"./@vxe-ui.1c5cc959.1753605037589.js";import"./dom-zindex.d72a3c32.1753605037589.js";import"./vue.5e2bff9c.1753605037589.js";import"./vxe-pc-ui.ed308165.1753605037589.js";import"./vue-pick-colors.10d84206.1753605037589.js";import"./@popperjs.f3391c26.1753605037589.js";const L=["#FF0000","#FF4500","#FFA500","#FFD700","#FFFF00","#9ACD32","#00FF00","#00FA9A","#00FFFF","#1E90FF","#0000FF","#8A2BE2","#9932CC","#FF00FF","#FF1493","#FF69B4","#FF6347","#FF8C00","#7CFC00","#40E0D0"];function be(){return L[Math.floor(Math.random()*L.length)]}const N=F=>{const _=new Date(F),f=_.getHours().toString().padStart(2,"0"),m=_.getMinutes().toString().padStart(2,"0");return`${f}:${m}`},G=(F,_,f,m,h,x,y,E,d,w,g)=>({aspectRatio:20,expandRows:!1,plugins:[ie,ae,de,ue,me],themeSystem:"bootstrap",eventBorderColor:"#3788d8",height:"1000px",slotEventOverlap:!1,slotMinTime:"09:00:00",slotMaxTime:"21:00:00",initialView:"timeGridDay",contentHeight:600,slotDuration:"00:10:00",slotLabelInterval:"01:00:00",selectMirror:!1,locale:pe,buttonText:{month:"月",week:"周",day:"日",list:"列表"},headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},customButtons:{button:{text:"custom",click:function(){alert("clicked the custom button!")}}},editable:!1,selectable:!1,weekNumbers:!0,views:{timeGridFourDay:{type:"timeGrid",duration:{days:7}}},events:async(e,t,c)=>{console.log("1、fetchInfo",g);let v=(await T.scheduleController.list({startStr:e.startStr,endStr:e.endStr,coach_id:g})).map(a=>({...a,title:a.course.title,start:a.start_time,end:a.end_time}));return console.log("1、req",v),await t(v),!1},eventClick:e=>{F(e)},dateClick:function(e){_(e)},eventDidMount:function(e){f(e)},select:function(e){let t=new Date(e.start.setHours(e.start.getHours()+8)),c=new Date(e.end.setHours(e.end.getHours()+8)),p=be();this.setOption("eventColor",p),m({title:"新事件",start:t,end:c,backgroundColor:p,borderColor:p,textColor:"white"})},eventAdd:function(e){h(e)},eventChange:function(e){console.log("1、eventChange",e),x(e)},eventContent:(e,t)=>{const c=e.event.start,p=e.event.end,v=e.backgroundColor,a=document.createElement("div");return a.style.height="100%",a.style.overflow="hidden",a.innerHTML=`
            <div style='background-color:${v};height:100%;max-width:300px;'>
            <div class='bg-gray-800  text-md font-bold' style="box-sizing:border-box;max-width:300px;">
            ⏰${N(c)} - ${N(p)}${e.event.title} #${e.event.id}
            </div>
                <div style='padding:6px;box-sizing:border-box;'>
                    <div class='text-xl font-bold'>👩🏻‍🏫${e.event.extendedProps.coach?e.event.extendedProps.coach.username:"未知"}</div>
                    <div class='flex justify-between items-center overflow-hidden'>
                        <div>${e.event.title?e.event.title:"未知"}</div>
                        <div>${e.event.extendedProps.course?e.event.extendedProps.course.venue.name:"未知"}</div>
                    </div>
                    <div class='flex justify-between items-center overflow-hidden'>
                        <div>约${e.event.extendedProps.schedule?e.event.extendedProps.schedule:"未知"}</div>
                        <div>签${e.event.extendedProps.sign?e.event.extendedProps.sign:"未知"}</div>
                    </div>
                </div>
    </div>
    `,y(e,t,a),{domNodes:[a]}},eventMouseEnter:function(e){E(e)},eventMouseLeave:function(e){d(e)},eventDrop:function(e){w(e)},dayMaxEventRows:2,timeZone:"local",dayHeaderContent:function(e){return _e("div",{style:{width:"100%",lineHeight:"50px",fontSize:"18px",height:"50px",color:"#1E90FFFF"}},e.text)}}),ge=O({__name:"index",props:{modelValue:{type:Array,default:()=>[]},coach_id:{type:Number,default:0}},emits:["update:modelValue","update:coach_id"],setup(F,{expose:_,emit:f}){fe();const m=k(),h=F,x=f,y=k([]),E=o=>{const n=y.value.findIndex(C=>C.id===o.id);return n===-1?(y.value.push(o),!0):(y.value.splice(n,1),!1)},d={animation:"heartbeat .1s infinite alternate"},w=o=>{const n=o.el;E(o.event)?Object.assign(n.style,d):n.style.removeProperty("animation");let C=[];C=y.value,x("update:modelValue",C)},g=o=>{console.log("子组件：空白处被点击",o)},e=o=>{const n=o.el;n.style.maxWidth="300px",n.style.transition="all 0.3s ease-out",n.style.transform="scale(1)",n.style.boxShadow="0 2px 5px rgba(0, 0, 0, 0.1)",n.style.margin="10px",n.addEventListener("mouseenter",()=>{n.style.boxShadow="0 5px 15px rgba(0, 0, 0, 0.5)",n.style.transform="scale(0.98)",n.style.zIndex="100"}),n.addEventListener("mouseleave",()=>{n.style.boxShadow="0 2px 5px rgba(0, 0, 0, 0.1)",n.style.transform="scale(1)",n.style.zIndex=""})},t=o=>{console.log("子组件：选择事件选择",o)},c=o=>{},p=o=>{console.log("子组件：事件被触发",o)},v=(o,n,C)=>{console.log("子组件：自定义样式")},a=o=>{},A=o=>{},D=o=>{console.log("子组件：拖拽事件时")};let M=G(w,g,e,t,c,p,v,a,A,D,h.coach_id);return U(()=>h.coach_id,o=>{M=G(w,g,e,t,c,p,v,a,A,D,o)}),_({refresh:()=>{console.log("refresh");const o=m.value.getApi();o.removeAllEvents(),o.refetchEvents()}}),(o,n)=>(S(),V("div",null,[r(u(ce),{options:u(M),ref_key:"fullCalendarRef",ref:m},null,8,["options"])]))}});const Ce={class:"w-full min-h-96 bg-green-200 rounded-sm mb-3 text-white p-2 box-border"},ke={class:"appo-content"},Fe={class:"absolute bottom-0 right-0"},he=O({__name:"reservation",setup(F){const _=k(),f=k(),m=k([]);U(()=>m,e=>{console.log("gschedule_info",e)});const h=[{title:"序号",dataIndex:"id",key:"id"},{title:"用户",dataIndex:"username",key:"username"},{title:"预约时间",dataIndex:"reserve_time",key:"reserve_time"},{title:"操作",dataIndex:"action",key:"action"}],x=k([]),y=async e=>{await T.reservationController.destroy({id:e}),x.value.splice(x.value.indexOf(e),1)},E=e=>{console.log(e.extendedProps.reservations),x.value=e.extendedProps.reservations},d=k({coach_id:null,user_id:null,username:null,gschedule_ids:[],way:"backend"}),w=()=>{console.log(d.value.coach_id),f.value.refresh()},g=async()=>{_.value.validate().then(async()=>{let e=m.value.map(t=>+t.id);if(e.length==0)return Y.error("请选择预约课程");d.value.gschedule_ids=e,await T.reservationController.store(d.value),f.value.refresh()})};return(e,t)=>{const c=W,p=Z,v=re,a=J,A=se,D=K,M=Q,I=X,o=ee,n=te,C=oe,j=ne;return S(),V("div",null,[r(o,{gutter:[16,16]},{default:l(()=>[r(c,{span:16},{default:l(()=>[r(ge,{modelValue:u(m),"onUpdate:modelValue":t[0]||(t[0]=s=>xe(m)?m.value=s:null),coach_id:u(d).coach_id,"onUpdate:coach_id":t[1]||(t[1]=s=>u(d).coach_id=s),ref_key:"calRef",ref:f},null,8,["modelValue","coach_id"])]),_:1}),t[21]||(t[21]=i()),r(c,{span:8},{default:l(()=>[r(j,null,{default:l(()=>[r(M,{model:u(d),ref_key:"formRef",ref:_},{default:l(()=>[r(a,{label:"选择教练",name:"coach_id",rules:[{required:!0,message:"请选择教练"}]},{default:l(()=>[r(v,{modelValue:u(d).coach_id,"onUpdate:modelValue":t[2]||(t[2]=s=>u(d).coach_id=s)},{default:l(()=>[r(p,{onClick:w,type:"primary"},{default:l(()=>t[5]||(t[5]=[i("筛选")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t[7]||(t[7]=i()),r(a,{label:"会员",name:"user_id",rules:[{required:!0,message:"请选择会员",trigger:"change"}]},{default:l(()=>[r(D,null,{default:l(()=>[r(A,{id:u(d).user_id,"onUpdate:id":t[3]||(t[3]=s=>u(d).user_id=s),username:u(d).username,"onUpdate:username":t[4]||(t[4]=s=>u(d).username=s)},null,8,["id","username"])]),_:1})]),_:1}),t[8]||(t[8]=i()),r(a,null,{default:l(()=>[r(p,{type:"primary",onClick:g},{default:l(()=>t[6]||(t[6]=[i(`
                确认约课
              `)])),_:1})]),_:1})]),_:1},8,["model"]),t[17]||(t[17]=i()),r(I,null,{default:l(()=>[i(" 预约："+$(u(m).length)+"课",1)]),_:1}),t[18]||(t[18]=i()),b("div",Ce,[r(o,{gutter:[16,24]},{default:l(()=>[(S(!0),V(H,null,ye(u(m),(s,P)=>(S(),B(c,{span:6,key:P,class:"appo-box"},{default:l(()=>[b("div",{class:"appo-header px-2 box-border",style:R({backgroundColor:s.backgroundColor})},[b("div",null,$(s.title),1),t[9]||(t[9]=i()),b("div",null,$(s.extendedProps.coach?s.extendedProps.coach.username:""),1)],4),t[13]||(t[13]=i()),b("div",ke,[b("div",{style:R({color:s.backgroundColor})},$(u(le)(s.startStr).format("YYYY-MM-DD HH:mm:ss")),5),t[11]||(t[11]=i()),b("span",{class:"text-sm text-right",style:R({color:s.backgroundColor})},$(s.extendedProps.course.venue.name),5),t[12]||(t[12]=i()),b("div",Fe,[r(p,{type:"primary",danger:"",size:"small",onClick:q=>E(s)},{default:l(()=>t[10]||(t[10]=[i("查看")])),_:2},1032,["onClick"])])])]),_:2},1024))),128))]),_:1})]),t[19]||(t[19]=i()),r(I,null,{default:l(()=>t[14]||(t[14]=[i("取消预约")])),_:1}),t[20]||(t[20]=i()),r(C,{columns:h,"data-source":u(x),size:"small",bordered:""},{bodyCell:l(({column:s,record:P})=>[s.dataIndex==="action"?(S(),B(n,{key:0,title:"确认取消吗？","ok-text":"是","cancel-text":"否",onConfirm:q=>y(P.id)},{default:l(()=>[r(p,{type:"link",danger:""},{default:l(()=>t[15]||(t[15]=[i("取消")])),_:1})]),_:2},1032,["onConfirm"])):z("",!0),t[16]||(t[16]=i()),s.dataIndex==="username"?(S(),V(H,{key:1},[i($(P.user.username),1)],64)):z("",!0)]),_:1},8,["data-source"])]),_:1})]),_:1})]),_:1})])}}});const At=ve(he,[["__scopeId","data-v-65b03ed7"]]);export{At as default};
//# sourceMappingURL=reservation.3db69ffb.1753605037589.js.map
