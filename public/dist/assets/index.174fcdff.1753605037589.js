import{b as E,r as H,s as Z,t as J,ab as ne,o as A,i as ae,l as K,I as Q,g as j,G as W,O as se,a9 as re,n as X,aa as ie,$ as ue,F as pe,E as de}from"./ant-design-vue.00fd9e7c.1753605037589.js";import{r as u,w as S,Z as _,_ as k,S as me,I as o,c as l,a3 as n,F as I,a7 as N,a2 as T,a5 as q,$ as x,u as M,a1 as fe,z as _e,E as ve,d as ge,e as ce}from"./@vue.3ad65df9.1753605037589.js";import{A as B,a as ye}from"./index-a4f0172e.js";import{am as xe}from"./@ant-design.002a57d7.1753605037589.js";import"./@babel.ff5fac95.1753605037589.js";import"./resize-observer-polyfill.0f9f8adb.1753605037589.js";import"./vue-types.ef06c517.1753605037589.js";import"./@ctrl.110cde02.1753605037589.js";import"./dom-align.ecb06dd6.1753605037589.js";import"./lodash-es.3d27f5e2.1753605037589.js";import"./dayjs.d60d73bd.1753605037589.js";import"./async-validator.dee29e8b.1753605037589.js";import"./scroll-into-view-if-needed.583c97c5.1753605037589.js";import"./compute-scroll-into-view.183f845a.1753605037589.js";import"./vue-router.9360959a.1753605037589.js";import"./pinia.11f4bfaa.1753605037589.js";import"./vue-demi.71ba0ef2.1753605037589.js";import"./axios.dcb3bfcc.1753605037589.js";import"./qs.247a6393.1753605037589.js";import"./side-channel.9d8f1847.1753605037589.js";import"./es-errors.c75f5a96.1753605037589.js";import"./object-inspect.0fbacf7d.1753605037589.js";import"./side-channel-list.c76608c5.1753605037589.js";import"./side-channel-map.76c430fe.1753605037589.js";import"./get-intrinsic.7d53f00e.1753605037589.js";import"./es-object-atoms.11ea1ab9.1753605037589.js";import"./math-intrinsics.9389030e.1753605037589.js";import"./gopd.30775706.1753605037589.js";import"./es-define-property.27915812.1753605037589.js";import"./has-symbols.76fb15e9.1753605037589.js";import"./get-proto.757e385d.1753605037589.js";import"./dunder-proto.05150bcd.1753605037589.js";import"./call-bind-apply-helpers.0833f3e9.1753605037589.js";import"./function-bind.61637ca6.1753605037589.js";import"./hasown.67f3f833.1753605037589.js";import"./call-bound.09054f06.1753605037589.js";import"./side-channel-weakmap.4b9abb6a.1753605037589.js";import"./stepin.df3b4e80.1753605037589.js";import"./enquire.js.29d23a08.1753605037589.js";import"./lodash.5999789d.1753605037589.js";import"./js-cookie.df2f1d76.1753605037589.js";import"./@vueuse.60746e97.1753605037589.js";import"./clipboard.f49c93fb.1753605037589.js";import"./highlight.js.1f23b1ae.1753605037589.js";import"./nprogress.dafb99c9.1753605037589.js";import"./vxe-table.a5304289.1753605037589.js";import"./xe-utils.0b26132f.1753605037589.js";import"./@vxe-ui.1c5cc959.1753605037589.js";import"./dom-zindex.d72a3c32.1753605037589.js";import"./vue.5e2bff9c.1753605037589.js";import"./vxe-pc-ui.ed308165.1753605037589.js";import"./vue-pick-colors.10d84206.1753605037589.js";import"./@popperjs.f3391c26.1753605037589.js";const be={class:"ant-upload-drag-icon"},Ce={__name:"FileUpload",props:{modelValue:Boolean,cate_id:Number,folders:Array},emits:["update:modelValue","success"],setup(U,{emit:w}){u(null);const $=t=>{const a=t.file.status;a==="done"?E.success(`${t.file.name} file uploaded successfully.`):a==="error"&&E.error(`上传失败：${t.file.response.data}`)},F={Authorization:"Bearer "+localStorage.getItem("token")},v=U,g=u([]),f=u([]);u();const r=w,d=u(v.modelValue);S(()=>v.modelValue,t=>{d.value=t});const b=u(null);S(()=>v.cate_id,t=>{b.value=t}),S(()=>v.folders,t=>{f.value=t});const m=t=>{b.value=t},c=()=>{r("update:modelValue",!1)};return(t,a)=>{const C=H,V=Z,z=J,L=ne,i=A;return _(),k("div",null,[me(t.$slots,"default"),a[9]||(a[9]=o()),l(i,{visible:d.value,"onUpdate:visible":a[1]||(a[1]=e=>d.value=e),title:"上传文件",onCancel:c,style:{width:"500px"},maskClosable:!1,center:!0},{default:n(()=>[l(z,{label:"文件夹"},{default:n(()=>[l(V,{onChange:m},{default:n(()=>[l(C,{value:""},{default:n(()=>a[2]||(a[2]=[o("请选择分类")])),_:1}),a[3]||(a[3]=o()),(_(!0),k(I,null,N(f.value,(e,p)=>(_(),T(C,{key:p,value:e.id},{default:n(()=>[o(q(e.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1}),a[8]||(a[8]=o()),l(L,{fileList:g.value,"onUpdate:fileList":a[0]||(a[0]=e=>g.value=e),name:"file",multiple:!0,action:`/api/admin/upload?cate_id=${b.value}`,headers:F,onChange:$},{default:n(()=>[x("p",be,[l(M(xe))]),a[4]||(a[4]=o()),a[5]||(a[5]=x("p",{class:"ant-upload-text"},"点击或者拖拽上传内容",-1)),a[6]||(a[6]=o()),a[7]||(a[7]=x("p",{class:"ant-upload-hint"},`
          支持多种格式，单文件多文件都支持
        `,-1))]),_:1},8,["fileList","action"])]),_:1},8,["visible"])])}}};const ke={class:"mt-3"},we=["onClick"],$e={class:"border border-solid border-stone-200"},Ve={class:"w-[140px] h-[140px] text-center",style:{border:".5px dotted #e5e7eb"}},Fe={class:"text-center font-light text-xs text-blue-400"},Ue={class:"flex"},ze=["for"],Be={__name:"FileList",props:{folders:Array},emits:["open-folder","delete-folder","download-file","delete-file"],setup(U,{expose:w,emit:$}){const F=i=>{r.value.cid=i.id,C()},v="https://hongyu.cyou",g=U,f=u(0),r=u({name:"",cid:0,currentPage:1,pageSize:24}),d=u([]),b=u([]);S(()=>g.folders,i=>{b.value=i},{immediate:!0,deep:!0});const m=()=>{C()},c=async i=>{var p;r.value.currentPage=i;let e=await B.fileController.index(r.value);d.value=e.data,f.value=e.total,r.value.currentPage=(p=e.meta)==null?void 0:p.current_page},t=u(!1);S(()=>t,i=>{i||console.log("==================",i)});const a=u({del_ids:[]}),C=async()=>{var e;let i=await B.fileController.index(r.value);d.value=i.data,f.value=i.total,r.value.currentPage=(e=i.meta)==null?void 0:e.current_page},V=async i=>{await B.fileController.update({id:i.id},i)},z=async()=>{A.confirm({content:"删除所有",async onOk(){await B.fileController.delBatch(a.value)},cancelText:"Click to destroy all",onCancel(){A.destroyAll()}})},L=async i=>{let e=`${v}/uploads/${i}`,p="";try{const y=await fetch(e);if(!y.ok)throw new Error(`HTTP error! status: ${y.status}`);const P=await y.text();console.log(P),p=P}catch(y){console.error("Fetch error:",y)}A.info({title:"查看文件",content:p,okText:"关闭",cancelText:"取消",width:"60%",style:{top:"20px"}})};return w({searchBy:m}),(i,e)=>{const p=ae,y=K,P=Q,R=j,Y=W,h=se,ee=fe("file-filled"),te=re,G=X,le=ie,oe=ue;return _(),k("div",ke,[l(G,{gutter:[32,2]},{default:n(()=>[l(y,{span:4},{default:n(()=>[x("div",null,[l(p,{size:"small"},{default:n(()=>e[8]||(e[8]=[x("span",{class:"text-sm"},"文件夹",-1)])),_:1}),e[9]||(e[9]=o()),(_(!0),k(I,null,N(b.value,(s,O)=>(_(),k("div",{key:O,onClick:D=>F(s),class:"flex h-12 w-full cursor-pointer text-sky-400 border border-solid border-gray-200 px-3 py-4"},q(s.name),9,we))),128))])]),_:1}),e[25]||(e[25]=o()),l(y,{span:20},{default:n(()=>[l(Y,null,{default:n(()=>[l(P,{placeholder:"请输入内容",value:r.value.name,"onUpdate:value":e[0]||(e[0]=s=>r.value.name=s),style:{width:"400px"}},null,8,["value"]),e[14]||(e[14]=o()),l(R,{type:"primary",danger:"",onClick:m},{default:n(()=>e[10]||(e[10]=[o("搜索")])),_:1}),e[15]||(e[15]=o()),l(R,{type:"primary",plain:"",onClick:e[1]||(e[1]=s=>r.value.name="")},{default:n(()=>e[11]||(e[11]=[o("清空")])),_:1}),e[16]||(e[16]=o()),l(Ce,{modelValue:t.value,"onUpdate:modelValue":e[3]||(e[3]=s=>t.value=s),cate_id:r.value.cid,"onUpdate:cate_id":e[4]||(e[4]=s=>r.value.cid=s),folders:b.value},{default:n(()=>[l(R,{onClick:e[2]||(e[2]=s=>t.value=!0)},{default:n(()=>e[12]||(e[12]=[o("上传文件")])),_:1})]),_:1},8,["modelValue","cate_id","folders"]),e[17]||(e[17]=o()),_e(l(R,{type:"primary",danger:"",plain:"",onClick:z},{default:n(()=>e[13]||(e[13]=[o("删除")])),_:1},512),[[ve,a.value.del_ids.length>0]])]),_:1}),e[23]||(e[23]=o()),x("div",$e,[l(le,{value:a.value.del_ids,"onUpdate:value":e[5]||(e[5]=s=>a.value.del_ids=s),class:"min-h-[700px] mt-2",style:{width:"100%"}},{default:n(()=>[l(G,{gutter:[32,64]},{default:n(()=>[(_(!0),k(I,null,N(d.value,(s,O)=>(_(),T(y,{span:3,key:O},{default:n(()=>[x("div",Ve,[s.type==="image"?(_(),T(h,{key:0,ref_for:!0,ref:"imageRef",height:140,style:{height:"140px","object-fit":"cover"},src:`${M(v)}/uploads/${s.path}`,"preview-src-list":[`${M(v)}/uploads/${s.path}`]},null,8,["src","preview-src-list"])):(_(),T(ee,{key:1,onClick:D=>L(s.path),height:"160px",width:"160px",style:{width:"160px",height:"160px","font-size":"160px",color:"#e6a23c"}},null,8,["onClick"])),e[22]||(e[22]=o()),x("div",Fe,[x("div",Ue,[l(P,{class:"flex-1",ref_for:!0,ref:"inputRef",value:s.name,"onUpdate:value":D=>s.name=D,type:"text",size:"small",style:{width:"100%",color:"grey"}},null,8,["value","onUpdate:value"]),e[19]||(e[19]=o()),l(R,{size:"small",type:"link",onClick:D=>V(s)},{default:n(()=>e[18]||(e[18]=[o("改名")])),_:2},1032,["onClick"])]),e[21]||(e[21]=o()),x("div",null,[x("label",{class:"text-lg cursor-pointer",for:`f-${s.id}`},"选择",8,ze),e[20]||(e[20]=o()),l(te,{id:`f-${s.id}`,value:s.id},null,8,["id","value"])])])])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),e[24]||(e[24]=o()),l(oe,{class:"mt-3","current-page":r.value.currentPage,"onUpdate:currentPage":e[6]||(e[6]=s=>r.value.currentPage=s),"page-size":r.value.pageSize,"onUpdate:pageSize":e[7]||(e[7]=s=>r.value.pageSize=s),"page-sizes":[24,48,96],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:f.value,onChange:c,"show-total":s=>`共 ${s} 条`},null,8,["current-page","page-size","total","show-total"])]),_:1})]),_:1})])}}},Se={__name:"FoldCreate",props:{modelValue:Boolean},emits:["update:modelValue","success"],setup(U,{emit:w}){const $=u(),F=async()=>{await B.fileCateController.store(d.value)},v=u([]),g=U,f=u(g.modelValue);S(()=>g.modelValue,c=>{f.value=c,console.log("watch",f.value)},{immediate:!0});const r=w,d=u({pid:null,name:"",type:""}),b=async()=>{var c;(c=$.value)==null||c.validateFields().then(async t=>{console.log("res",t),await F(d.value),E.error({content:"成功",key:"success"}),r("success"),r("update:modelValue",!1)}).catch(t=>{console.error(t)}).finally(()=>{})},m=()=>{r("update:modelValue",!1)};return(c,t)=>{const a=H,C=Z,V=J,z=Q,L=pe,i=j,e=A;return _(),k("div",null,[l(e,{visible:f.value,"onUpdate:visible":t[3]||(t[3]=p=>f.value=p),title:"创建文件夹",onClose:m,maskClosable:!1},{footer:n(()=>[l(i,{onClick:m},{default:n(()=>t[15]||(t[15]=[o("取消")])),_:1}),t[17]||(t[17]=o()),l(i,{type:"primary",onClick:b},{default:n(()=>t[16]||(t[16]=[o("创建")])),_:1})]),default:n(()=>[l(L,{model:d.value,"laba-width":"100px",ref_key:"formRef",ref:$},{default:n(()=>[l(V,{label:"父级",name:"pid","has-feedback":""},{default:n(()=>[l(C,{value:d.value.pid,"onUpdate:value":t[0]||(t[0]=p=>d.value.pid=p)},{default:n(()=>[(_(!0),k(I,null,N(v.value,(p,y)=>(_(),T(a,{label:"",key:y,value:p.id},{default:n(()=>[o(q(p.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t[13]||(t[13]=o()),l(V,{label:"文件夹名称",name:"name","has-feedback":"",rules:[{required:!0,message:"请输入名称"}]},{default:n(()=>[l(z,{value:d.value.name,"onUpdate:value":t[1]||(t[1]=p=>d.value.name=p)},null,8,["value"])]),_:1}),t[14]||(t[14]=o()),l(V,{label:"文件类型",name:"type","has-feedback":"",rules:[{required:!0,message:"请选择类型"}]},{default:n(()=>[l(C,{value:d.value.type,"onUpdate:value":t[2]||(t[2]=p=>d.value.type=p)},{default:n(()=>[l(a,{value:""},{default:n(()=>t[4]||(t[4]=[o("请选择")])),_:1}),t[9]||(t[9]=o()),l(a,{value:"image"},{default:n(()=>t[5]||(t[5]=[o("图片")])),_:1}),t[10]||(t[10]=o()),l(a,{value:"video"},{default:n(()=>t[6]||(t[6]=[o("视频")])),_:1}),t[11]||(t[11]=o()),l(a,{value:"audio"},{default:n(()=>t[7]||(t[7]=[o("音频")])),_:1}),t[12]||(t[12]=o()),l(a,{value:"file"},{default:n(()=>t[8]||(t[8]=[o("文件")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"]),t[18]||(t[18]=o())]),_:1},8,["visible"])])}}},Le=ge({__name:"FileManager",setup(U){const w=u([]),$=async()=>{w.value=await B.fileCateController.list()},F=u(null),v=u(!1),g=u(!1),f=async()=>{await $(),F.value.searchBy()},r=()=>{g.value=!0},d=()=>{v.value=!1,g.value=!1};return ce(()=>{f()}),u(!1),(b,m)=>{const c=j,t=de,a=W,C=K,V=X;return _(),k("div",null,[l(a,null,{default:n(()=>[l(t,null,{default:n(()=>[l(c,{type:"primary",onClick:r},{default:n(()=>m[1]||(m[1]=[o("创建文件夹")])),_:1})]),_:1})]),_:1}),m[2]||(m[2]=o()),l(V,null,{default:n(()=>[l(C,{span:24},{default:n(()=>[l(Be,{folders:w.value,onRefresh:f,ref_key:"fileListRef",ref:F},null,8,["folders"])]),_:1})]),_:1}),m[3]||(m[3]=o()),l(Se,{modelValue:g.value,"onUpdate:modelValue":m[0]||(m[0]=z=>g.value=z),onSuccess:f,onResetVisible:d},null,8,["modelValue"])])}}}),Pe={};function Re(U,w){const $=Le;return _(),k("div",null,[l($)])}const Rt=ye(Pe,[["render",Re]]);export{Rt as default};
//# sourceMappingURL=index.174fcdff.1753605037589.js.map
