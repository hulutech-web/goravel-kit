import{i as D,q as F,l as N,I as P,t as B,g as j,c as T,f as G,e as K,U as Q,R as X,p as W,F as Z,K as J,n as L}from"./ant-design-vue.00fd9e7c.1753605037589.js";import{d as w}from"./dayjs.d60d73bd.1753605037589.js";import{r as h,e as ee,A as _}from"./index-a4f0172e.js";import{X as te}from"./xe-utils.0b26132f.1753605037589.js";import{f as oe,d as re,r as q,a1 as R,Z as ae,_ as le,c as t,a3 as r,I as l,a4 as se,bs as ne,u as c,$ as U}from"./@vue.3ad65df9.1753605037589.js";import{u as ie}from"./vue-router.9360959a.1753605037589.js";import"./@babel.ff5fac95.1753605037589.js";import"./resize-observer-polyfill.0f9f8adb.1753605037589.js";import"./vue-types.ef06c517.1753605037589.js";import"./@ant-design.002a57d7.1753605037589.js";import"./@ctrl.110cde02.1753605037589.js";import"./dom-align.ecb06dd6.1753605037589.js";import"./lodash-es.3d27f5e2.1753605037589.js";import"./async-validator.dee29e8b.1753605037589.js";import"./scroll-into-view-if-needed.583c97c5.1753605037589.js";import"./compute-scroll-into-view.183f845a.1753605037589.js";import"./pinia.11f4bfaa.1753605037589.js";import"./vue-demi.71ba0ef2.1753605037589.js";import"./axios.dcb3bfcc.1753605037589.js";import"./qs.247a6393.1753605037589.js";import"./side-channel.9d8f1847.1753605037589.js";import"./es-errors.c75f5a96.1753605037589.js";import"./object-inspect.0fbacf7d.1753605037589.js";import"./side-channel-list.c76608c5.1753605037589.js";import"./side-channel-map.76c430fe.1753605037589.js";import"./get-intrinsic.7d53f00e.1753605037589.js";import"./es-object-atoms.11ea1ab9.1753605037589.js";import"./math-intrinsics.9389030e.1753605037589.js";import"./gopd.30775706.1753605037589.js";import"./es-define-property.27915812.1753605037589.js";import"./has-symbols.76fb15e9.1753605037589.js";import"./get-proto.757e385d.1753605037589.js";import"./dunder-proto.05150bcd.1753605037589.js";import"./call-bind-apply-helpers.0833f3e9.1753605037589.js";import"./function-bind.61637ca6.1753605037589.js";import"./hasown.67f3f833.1753605037589.js";import"./call-bound.09054f06.1753605037589.js";import"./side-channel-weakmap.4b9abb6a.1753605037589.js";import"./stepin.df3b4e80.1753605037589.js";import"./enquire.js.29d23a08.1753605037589.js";import"./lodash.5999789d.1753605037589.js";import"./js-cookie.df2f1d76.1753605037589.js";import"./@vueuse.60746e97.1753605037589.js";import"./clipboard.f49c93fb.1753605037589.js";import"./highlight.js.1f23b1ae.1753605037589.js";import"./nprogress.dafb99c9.1753605037589.js";import"./vxe-table.a5304289.1753605037589.js";import"./@vxe-ui.1c5cc959.1753605037589.js";import"./dom-zindex.d72a3c32.1753605037589.js";import"./vue.5e2bff9c.1753605037589.js";import"./vxe-pc-ui.ed308165.1753605037589.js";import"./vue-pick-colors.10d84206.1753605037589.js";import"./@popperjs.f3391c26.1753605037589.js";const ue=()=>({gridOptions:oe({border:"full",size:"small",showHeaderOverflow:!0,showOverflow:!0,keepSource:!0,autoResize:!0,expandConfig:{trigger:"row",showIcon:!0,expandRowKeys:[1,2],iconOpen:"vxe-icon--caret-bottom",iconClose:"vxe-icon--caret-top"},formConfig:{titleWidth:120,titleAlign:"right",items:[{field:"code",title:"卡券编码",span:6,itemRender:{name:"$input",props:{placeholder:"请输入卡券编码"}}},{span:8,align:"left",collapseNode:!0,itemRender:{name:"$buttons",children:[{props:{type:"submit",content:"搜索",status:"primary"}},{props:{type:"reset",content:"重置"}}]}}]},stripe:!0,id:"full_edit_9999",rowConfig:{keyField:"#",isHover:!0,useKey:!0},columnConfig:{resizable:!0},customConfig:{storage:!0,checkMethod({column:o}){return!["name","no"].includes(o.field)}},printConfig:{columns:[{field:"name"}]},sortConfig:{trigger:"cell",remote:!0},filterConfig:{remote:!0},pagerConfig:{enabled:!0,pageSize:10,pageSizes:[5,10,15,20,50,100,200,500,1e3]},toolbarConfig:{buttons:[{code:"insert_edit",name:"新增",status:"primary"},{code:"delete",name:"删除",status:"danger"},{code:"save",name:"保存",status:"success"}],refresh:!0,import:!1,export:!0,print:!0,zoom:!0,custom:!0},proxyConfig:{seq:!0,sort:!0,filter:!0,form:!0,props:{result:"data",total:"total"},showResponseMsg:!1,ajax:{query:async({page:o,sorts:i,filters:u,form:d})=>{const s=Object.assign({},d),p=i[0];return p&&(s.sort=p.field,s.order=p.order),u.forEach(({field:f,values:m})=>{s[f]=m.join(",")}),h({url:`/api/admin/ticket?pageSize=${o.pageSize}&currentPage=${o.currentPage}&${te.serialize(s)}`,method:"GET"})},delete:({body:o})=>{const i=o.removeRecords.map(u=>u.id);return ee(i)},save:({body:o})=>{const{insertRecords:i,updateRecords:u}=o,d=[];return i.length>0&&i.forEach(s=>{d.push(_.ticketController.store(s))}),u.length>0&&u.forEach(s=>{d.push(_.ticketController.update({id:s.id},s))}),Promise.all(d)}}},columns:[{field:"id",title:"序号",width:100},{field:"name",title:"券名",sortable:!0,editRender:{name:"AInput",props:{placeholder:"请输入券名"}}},{field:"code",title:"券编码",sortable:!0},{field:"type",title:"券类型",editRender:{name:"AInput",props:{placeholder:"请输入券类型"}}},{field:"value",title:"券值",editRender:{name:"AInputNumber",props:{placeholder:"请输入券类型"}}},{field:"valid_days",title:"有效天数",sortable:!0,editRender:{name:"AInputNumber",props:{placeholder:"请输入天数"}}},{field:"start_date",title:"开始时间",sortable:!0},{field:"expiry_date",title:"过期时间",sortable:!0},{field:"usage_limit",title:"可用次数"},{field:"status",title:"状态",slots:{default:"status"}},{field:"created_at",title:"创建时间"}],importConfig:{},exportConfig:{},checkboxConfig:{labelField:"ID",checkStrictly:!0},editRules:{name:[{required:!0,message:"必填"},{min:3,max:50,message:"名称长度在 3 到 50 个字符"}],no:[{required:!0,message:"必填"}]},editConfig:{trigger:"click",mode:"row",showStatus:!0,showUpdateStatus:!0,showInsertStatus:!0,autoClear:!0}})}),de={class:"steps-action"},dt=re({__name:"ticket",setup(H){const o=q({id:null,name:"",code:"",type:"",value:0,valid_days:5,start_date:"",expiry_date:"",usage_limit:1,status:1}),i=async()=>{await _.ticketController.store(o.value)};ie();const{gridOptions:u}=ue(),d=q(),s=async()=>{o.value.code=await _.qrController.makeQr()},p={proxyQuery(){d.value.getColumnByField("course_type_id")}},f=async m=>{await _.ticketController.invalid({id:m.id},{status:m.status},{showMessage:!0})};return(m,e)=>{const I=D,S=F,z=R("vxe-grid"),y=N,v=P,n=B,A=R("qrcode-outlined"),C=j,Y=T,E=G,g=K,b=Q,k=X,M=W,O=Z,V=J,$=L;return ae(),le("div",null,[t(I,null,{default:r(()=>e[9]||(e[9]=[l("门票管理")])),_:1}),e[28]||(e[28]=l()),t($,{gutter:[32,8]},{default:r(()=>[t(y,{span:18},{default:r(()=>[t(z,se({ref_key:"xGrid",ref:d},c(u),ne(p)),{status:r(({row:a})=>[t(S,{checked:a.status,"onUpdate:checked":x=>a.status=x,onChange:x=>f(a),checkedValue:1,unCheckedValue:2,"checked-children":"开","un-checked-children":"关"},null,8,["checked","onUpdate:checked","onChange"])]),_:1},16)]),_:1}),e[27]||(e[27]=l()),t(y,{span:6},{default:r(()=>[t(V,null,{default:r(()=>[e[25]||(e[25]=U("p",null,"创建门票",-1)),e[26]||(e[26]=l()),t(O,{model:o.value},{default:r(()=>[t(n,{name:"name",label:"名称",rules:[{required:!0,message:"必填"}]},{default:r(()=>[t(v,{value:o.value.name,"onUpdate:value":e[0]||(e[0]=a=>o.value.name=a)},null,8,["value"])]),_:1}),e[16]||(e[16]=l()),t(n,{name:"code",label:"编码",rules:[{required:!0,message:"必填"}]},{default:r(()=>[t(E,{compact:""},{default:r(()=>[t(v,{value:o.value.code,"onUpdate:value":e[1]||(e[1]=a=>o.value.code=a),style:{width:"calc(100% - 36px)"}},null,8,["value"]),e[10]||(e[10]=l()),t(Y,{title:"点击生成"},{default:r(()=>[t(C,{onClick:s},{icon:r(()=>[t(A)]),_:1})]),_:1})]),_:1})]),_:1}),e[17]||(e[17]=l()),t(n,{name:"type",label:"类型",rules:[{required:!0,message:"必填"}]},{default:r(()=>[t(v,{value:o.value.type,"onUpdate:value":e[2]||(e[2]=a=>o.value.type=a)},null,8,["value"])]),_:1}),e[18]||(e[18]=l()),t(n,{name:"value",label:"面值",rules:[{required:!0,message:"必填"}]},{default:r(()=>[t(g,{value:o.value.value,"onUpdate:value":e[3]||(e[3]=a=>o.value.value=a)},{addonAfter:r(()=>e[11]||(e[11]=[l("元")])),_:1},8,["value"])]),_:1}),e[19]||(e[19]=l()),t(n,{name:"valid_days",label:"有效期（天）",rules:[{required:!0,message:"必填"}]},{default:r(()=>[t(g,{value:o.value.valid_days,"onUpdate:value":e[4]||(e[4]=a=>o.value.valid_days=a)},null,8,["value"])]),_:1}),e[20]||(e[20]=l()),t(n,{name:"start_date",label:"开始时间",rules:[{required:!0,message:"必填"}]},{default:r(()=>[t(b,{value:o.value.start_date,"onUpdate:value":e[5]||(e[5]=a=>o.value.start_date=a),format:"YYYY-MM-DD HH:mm:ss","show-time":{defaultValue:c(w)("00:00:00","HH:mm:ss")}},null,8,["value","show-time"])]),_:1}),e[21]||(e[21]=l()),t(n,{name:"expiry_date",label:"过期时间",rules:[{required:!0,message:"必填"}]},{default:r(()=>[t(b,{value:o.value.expiry_date,"onUpdate:value":e[6]||(e[6]=a=>o.value.expiry_date=a),format:"YYYY-MM-DD HH:mm:ss","show-time":{defaultValue:c(w)("00:00:00","HH:mm:ss")}},null,8,["value","show-time"])]),_:1}),e[22]||(e[22]=l()),t(n,{name:"usage_limit",label:"限制（次）",rules:[{required:!0,message:"必填"}]},{default:r(()=>[t(g,{value:o.value.usage_limit,"onUpdate:value":e[7]||(e[7]=a=>o.value.usage_limit=a)},null,8,["value"])]),_:1}),e[23]||(e[23]=l()),t(n,{name:"status",label:"状态",rules:[{required:!0,message:"必填"}]},{default:r(()=>[t(M,{value:o.value.status,"onUpdate:value":e[8]||(e[8]=a=>o.value.status=a)},{default:r(()=>[t(k,{value:1},{default:r(()=>e[12]||(e[12]=[l("可用")])),_:1}),e[14]||(e[14]=l()),t(k,{value:2},{default:r(()=>e[13]||(e[13]=[l("下架")])),_:1})]),_:1},8,["value"])]),_:1}),e[24]||(e[24]=l()),t(n,null,{default:r(()=>[U("div",de,[t(C,{type:"primary","html-type":"submit",onClick:i},{default:r(()=>e[15]||(e[15]=[l(`\r
                  提交\r
                `)])),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})])}}});export{dt as default};
//# sourceMappingURL=ticket.3b19fdfd.1753605037589.js.map
