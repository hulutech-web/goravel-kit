{"version":3,"file":"mapinit.1c16a27e.1753605037589.js","sources":["../../src/pages/event/mapinit.ts"],"sourcesContent":["import coordtransform from \"coordtransform\";\nlet map: any = null;\nlet result = {\n    lat: null,\n    lng: null,\n    address: \"\",\n};\nconst state = reactive<any>({\n    markerLayer: \"\",\n    marker: null,\n    infoWindow: null,\n    value: 1,\n});\n/**\n * 添加点标记\n * @param data data\n */\nconst addImgMarker = (data: any) => {\n    // @ts-ignore\n    state.marker = new TMap.MultiMarker({\n        map: map,\n        // @ts-ignore\n        geometries: [{ position: new TMap.LatLng(data.lat, data.lng) }],\n    });\n};\n\n/**\n * 逆地址解析\n * @param e 待解析经纬度\n */\nconst getAddress = (e: any) => {\n    return new Promise((resolve, reject) => {\n\n        // @ts-ignore\n        const geocoder = new TMap.service.Geocoder(); // 新建一个正逆地址解析类\n        // @ts-ignore\n\n        const location = new TMap.LatLng(e.latLng.lat, e.latLng.lng);\n        geocoder.getAddress({ location: location }).then((res: any) => {\n            if (res.status === 0) {\n                state.infoWindow.open();\n                state.infoWindow.setPosition(e.latLng); // 设置信息窗位置\n                state.infoWindow.setContent(res.result.address); // 设置信息窗内容\n                result.address = res.result.address;\n                resolve(result);\n            }\n        });\n    });\n};\n\nconst mapInit = (callback, arr) => {\n    const TMap = (window as any).TMap;\n    let gcjLatLng = null;\n    //获取当前的位置信息\n    if (arr && Array.isArray(arr) && arr.length > 0) {\n        // console.log(\"arr\", arr);\n        gcjLatLng = coordtransform.wgs84togcj02(arr[0], arr[1]);\n    } else {\n        // 转换为 GCJ-02 坐标\n        gcjLatLng = coordtransform.wgs84togcj02(\n            31.20929040462313,\n            107.46796970075786\n        );\n    }\n    // 创建 Tencent Maps LatLng 对象\n    const center = new TMap.LatLng(gcjLatLng[0], gcjLatLng[1]);\n    map = new TMap.Map(document.getElementById(\"container\"), {\n        center: center, // 设置地图中心点坐标\n        zoom:14, // 设置地图缩放级别\n        viewMode: \"3D\",\n    });\n\n    addImgMarker(center);\n    // 监听地图点击事件\n    map.on(\"click\", (e: any) => {\n        // 清除点标记\n        state.marker.setMap(null);\n        // 关闭信息窗关闭\n        state.infoWindow.close();\n        state.marker = null;\n        // 添加点标记\n        addImgMarker(e.latLng);\n        // 地址解析\n        //获取点击处的经纬度\n        result.lat = e.latLng.lat;\n        result.lng = e.latLng.lng;\n        getAddress(e).then((r) => {\n            callback(result);\n        });\n    });\n\n    // 初始化infoWindow\n    state.infoWindow = new TMap.InfoWindow({\n        map: map,\n        position: center,\n        offset: { x: 0, y: -32 }, // 设置信息窗相对position偏移像素\n    });\n    // 初始关闭信息窗关闭\n    state.infoWindow.close();\n};\n\nexport default mapInit;\n"],"names":["map","result","state","reactive","addImgMarker","data","getAddress","e","resolve","reject","geocoder","location","res","mapInit","callback","arr","TMap","gcjLatLng","coordtransform","center","r"],"mappings":"+JACA,IAAIA,EAAW,KACXC,EAAS,CACT,IAAK,KACL,IAAK,KACL,QAAS,EACb,EACA,MAAMC,EAAQC,EAAc,CACxB,YAAa,GACb,OAAQ,KACR,WAAY,KACZ,MAAO,CACX,CAAC,EAKKC,EAAgBC,GAAc,CAE1BH,EAAA,OAAS,IAAI,KAAK,YAAY,CAChC,IAAAF,EAEA,WAAY,CAAC,CAAE,SAAU,IAAI,KAAK,OAAOK,EAAK,IAAKA,EAAK,GAAG,EAAG,CAAA,CACjE,CACL,EAMMC,EAAcC,GACT,IAAI,QAAQ,CAACC,EAASC,IAAW,CAGpC,MAAMC,EAAW,IAAI,KAAK,QAAQ,SAG5BC,EAAW,IAAI,KAAK,OAAOJ,EAAE,OAAO,IAAKA,EAAE,OAAO,GAAG,EAC3DG,EAAS,WAAW,CAAE,SAAAC,CAAoB,CAAA,EAAE,KAAMC,GAAa,CACvDA,EAAI,SAAW,IACfV,EAAM,WAAW,OACXA,EAAA,WAAW,YAAYK,EAAE,MAAM,EACrCL,EAAM,WAAW,WAAWU,EAAI,OAAO,OAAO,EACvCX,EAAA,QAAUW,EAAI,OAAO,QAC5BJ,EAAQP,CAAM,EAClB,CACH,CAAA,CACJ,EAGCY,EAAU,CAACC,EAAUC,IAAQ,CAC/B,MAAMC,EAAQ,OAAe,KAC7B,IAAIC,EAAY,KAEZF,GAAO,MAAM,QAAQA,CAAG,GAAKA,EAAI,OAAS,EAE1CE,EAAYC,EAAe,aAAaH,EAAI,CAAC,EAAGA,EAAI,CAAC,CAAC,EAGtDE,EAAYC,EAAe,aACvB,kBACA,kBAAA,EAIF,MAAAC,EAAS,IAAIH,EAAK,OAAOC,EAAU,CAAC,EAAGA,EAAU,CAAC,CAAC,EACzDjB,EAAM,IAAIgB,EAAK,IAAI,SAAS,eAAe,WAAW,EAAG,CACrD,OAAAG,EACA,KAAK,GACL,SAAU,IAAA,CACb,EAEDf,EAAae,CAAM,EAEfnB,EAAA,GAAG,QAAU,GAAW,CAElBE,EAAA,OAAO,OAAO,IAAI,EAExBA,EAAM,WAAW,QACjBA,EAAM,OAAS,KAEfE,EAAa,EAAE,MAAM,EAGdH,EAAA,IAAM,EAAE,OAAO,IACfA,EAAA,IAAM,EAAE,OAAO,IACtBK,EAAW,CAAC,EAAE,KAAMc,GAAM,CACtBN,EAASb,CAAM,CAAA,CAClB,CAAA,CACJ,EAGKC,EAAA,WAAa,IAAIc,EAAK,WAAW,CACnC,IAAAhB,EACA,SAAUmB,EACV,OAAQ,CAAE,EAAG,EAAG,EAAG,GAAI,CAAA,CAC1B,EAEDjB,EAAM,WAAW,OACrB"}