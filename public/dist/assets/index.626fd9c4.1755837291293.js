import{$ as D,F as ee,Q as K,L as Q,q as te,a1 as ge,e as G,n as N,h as ce,k as le,d as oe,V as ae,a2 as ye,W as be,l as ne,X as xe,K as ke,J as Ce,a3 as we}from"./ant-design-vue.6003db98.1755837291293.js";import{r as i,w as T,x as $e,Z as g,_ as $,S as Ve,I as t,c as l,a3 as o,F as M,a7 as X,a2 as R,a5 as O,$ as C,u as J,a1 as h,a0 as Ue,z as se,E as Fe,k as ze,d as Se,A as Be}from"./@vue.f517c4d3.1755837291293.js";import{r as re,A as j,a as Le}from"./index-e86a3d8d.js";import{am as Ae}from"./@ant-design.9d2fe45e.1755837291293.js";import{X as De}from"./xe-utils.dd761dc0.1755837291293.js";import"./@babel.ff5fac95.1755837291293.js";import"./resize-observer-polyfill.0f9f8adb.1755837291293.js";import"./vue-types.ef06c517.1755837291293.js";import"./@ctrl.110cde02.1755837291293.js";import"./dom-align.ecb06dd6.1755837291293.js";import"./lodash-es.3d27f5e2.1755837291293.js";import"./dayjs.ff9046db.1755837291293.js";import"./async-validator.dee29e8b.1755837291293.js";import"./scroll-into-view-if-needed.e8fe8fab.1755837291293.js";import"./compute-scroll-into-view.183f845a.1755837291293.js";import"./vue-router.9464b678.1755837291293.js";import"./pinia.8982db38.1755837291293.js";import"./vue-demi.71ba0ef2.1755837291293.js";import"./axios.dcb3bfcc.1755837291293.js";import"./qs.a529ec33.1755837291293.js";import"./side-channel.9e54de98.1755837291293.js";import"./es-errors.c75f5a96.1755837291293.js";import"./object-inspect.7e6175f7.1755837291293.js";import"./side-channel-list.169b004a.1755837291293.js";import"./side-channel-map.33f5b958.1755837291293.js";import"./get-intrinsic.a2929bf2.1755837291293.js";import"./es-object-atoms.11ea1ab9.1755837291293.js";import"./math-intrinsics.9389030e.1755837291293.js";import"./gopd.30775706.1755837291293.js";import"./es-define-property.27915812.1755837291293.js";import"./has-symbols.76fb15e9.1755837291293.js";import"./get-proto.0694628e.1755837291293.js";import"./dunder-proto.eacfd4c7.1755837291293.js";import"./call-bind-apply-helpers.7f6153fb.1755837291293.js";import"./function-bind.48f717dc.1755837291293.js";import"./hasown.62c0daf0.1755837291293.js";import"./call-bound.9966c24b.1755837291293.js";import"./side-channel-weakmap.d483489f.1755837291293.js";import"./stepin.98140aa1.1755837291293.js";import"./enquire.js.29d23a08.1755837291293.js";import"./lodash.907b933a.1755837291293.js";import"./js-cookie.df2f1d76.1755837291293.js";import"./@vueuse.9b0e1a90.1755837291293.js";import"./clipboard.1ee81d47.1755837291293.js";import"./highlight.js.f034732b.1755837291293.js";import"./nprogress.cfb775e5.1755837291293.js";import"./vxe-table.748bd7a0.1755837291293.js";import"./@vxe-ui.edbd1fdc.1755837291293.js";import"./dom-zindex.d72a3c32.1755837291293.js";import"./vue.39adf4ea.1755837291293.js";import"./vxe-pc-ui.0dbee1b4.1755837291293.js";import"./vue-pick-colors.8c35f1dd.1755837291293.js";import"./@popperjs.f3391c26.1755837291293.js";const Re={class:"ant-upload-drag-icon"},Te={__name:"FileUpload",props:{modelValue:Boolean,cate_id:Number,folders:Array},emits:["update:modelValue","success"],setup(L,{emit:V}){i(null);const U=r=>{const n=r.file.status;n==="done"?D.success(`${r.file.name} file uploaded successfully.`):n==="error"&&D.error(`上传失败：${r.file.response.data}`)},b=i({cate_id:null,files:[]}),S={Authorization:"Bearer "+localStorage.getItem("token")},u=L,m=i([]),f=i([]);i();const k=V,c=i(u.modelValue);T(()=>u.modelValue,r=>{c.value=r});const p=i(null);T(()=>u.cate_id,r=>{p.value=r}),T(()=>u.folders,r=>{f.value=r}),$e(r=>{b.value.files=r});const a=r=>(m.value=[...m.value||[],r],!1),w=r=>{p.value=r},F=()=>{k("update:modelValue",!1)},v=i(!1),z=async()=>{if(!p.value){D.error("请选择上传的文件夹");return}if(m.value.length===0){D.error("请选择上传的文件");return}v.value=!0;try{const r=m.value.map(A=>{const y=new FormData;return y.append("file",A.originFileObj),y.append("cate_id",p.value),re("/api/admin/upload",{method:"post",data:y,headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+localStorage.getItem("token")}})}),n=await Promise.all(r)}catch(r){console.error("上传错误:",r),D.error("上传过程中发生错误")}finally{v.value=!1}};return(r,n)=>{const A=ee,y=K,H=Q,I=te,d=ge,e=G,x=N;return g(),$("div",null,[Ve(r.$slots,"default"),n[12]||(n[12]=t()),l(x,{visible:c.value,"onUpdate:visible":n[2]||(n[2]=_=>c.value=_),title:"上传文件",onCancel:F,style:{width:"500px"},maskClosable:!1,center:!0,footer:!1},{default:o(()=>[l(A,{model:b.value},null,8,["model"]),n[9]||(n[9]=t()),l(I,{label:"文件夹"},{default:o(()=>[l(H,{onChange:w,value:b.value.cate_id,"onUpdate:value":n[0]||(n[0]=_=>b.value.cate_id=_)},{default:o(()=>[l(y,{value:""},{default:o(()=>n[3]||(n[3]=[t("请选择分类")])),_:1}),n[4]||(n[4]=t()),(g(!0),$(M,null,X(f.value,(_,B)=>(g(),R(y,{key:B,value:_.id},{default:o(()=>[t(O(_.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n[10]||(n[10]=t()),l(I,{label:"文件"},{default:o(()=>[l(d,{fileList:m.value,"onUpdate:fileList":n[1]||(n[1]=_=>m.value=_),name:"file",multiple:!0,headers:S,onChange:U,"before-upload":a},{default:o(()=>[C("p",Re,[l(J(Ae))]),n[5]||(n[5]=t()),n[6]||(n[6]=C("p",{class:"ant-upload-text"},"点击或者拖拽上传内容",-1)),n[7]||(n[7]=t()),n[8]||(n[8]=C("p",{class:"ant-upload-hint"},`
            支持多种格式，单文件多文件都支持
          `,-1))]),_:1},8,["fileList"])]),_:1}),n[11]||(n[11]=t()),l(I,null,{default:o(()=>[l(e,{type:"primary",disabled:m.value.length===0,loading:v.value,style:{"margin-top":"16px"},onClick:z},{default:o(()=>[t(O(v.value?"上传中...":"开始上传"),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1},8,["visible"])])}}};const Ie={class:"mt-3"},Ee=["onClick"],Pe={class:"my-2"},Ne={class:"text-sm text-blue-500"},Oe={class:"border border-solid border-stone-200"},je={class:"w-[140px] h-[140px] text-center",style:{border:".5px dotted #e5e7eb"}},qe={class:"text-center font-light text-xs text-blue-400"},Me={class:"flex"},Xe=["for"],Ge={__name:"FileList",props:{folders:Array},emits:["open-folder","delete-folder","download-file","delete-file"],setup(L,{expose:V,emit:U}){const b={}.VITE_API_URL?{}.VITE_API_URL:"",S=L,u=i({page:1,total:0,page_size:24}),m=i([]),f=i([]);T(()=>S.folders,d=>{f.value=d},{immediate:!0,deep:!0});const k=i(""),c=i(""),p=()=>{u.value.page=1,n()},a=async d=>{var x;console.log(d);let e=await j.fileController.index({cid:r.value?r.value:k.value,keyword:c.value,currentPage:d,pageSize:24});m.value=e.data,u.value.total=e.total,u.value.page=(x=e.meta)==null?void 0:x.current_page},w=i(!1),F=i(null);T(()=>w,d=>{d||console.log("==================",d)});const v=i({del_ids:[]}),z=i(!1),r=i(null),n=async d=>{var x;d&&(u.value.page=1),console.log("loadFolderData",c.value,k.value),z.value=!0,r.value=d,console.log(c.value);let e=await re({url:`/api/admin/file?pageSize=24&currentPage=${u.value.page}&${De.serialize({name:c.value,cid:r.value?r.value:k.value})}`,method:"GET"});m.value=e.data,u.value.total=e.total,u.value.page=(x=e.meta)==null?void 0:x.current_page,z.value=!1},A=async d=>{await j.fileController.update({id:d.id},d)},y=d=>{console.log(d)},H=async()=>{N.confirm({content:"删除所有",async onOk(){await j.fileController.delBatch(v.value)},cancelText:"Click to destroy all",onCancel(){N.destroyAll()}})},I=async d=>{let e=`${b}/uploads/${d}`,x="";try{const _=await fetch(e);if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);const B=await _.text();console.log(B),x=B}catch(_){console.error("Fetch error:",_)}N.info({title:"查看文件",content:x,okText:"关闭",cancelText:"取消",width:"60%",style:{top:"20px"}})};return V({searchBy:p}),(d,e)=>{const x=ce,_=h("folder-filled"),B=le,W=K,ue=Q,Z=oe,E=G,ie=ae,pe=ye,de=h("file-filled"),me=be,Y=ne,fe=xe,ve=ke,_e=Ce;return g(),$("div",Ie,[l(Y,{gutter:[32,2]},{default:o(()=>[l(B,{span:4},{default:o(()=>[l(x,null,{default:o(()=>e[9]||(e[9]=[t("文件夹")])),_:1}),e[12]||(e[12]=t()),(g(!0),$(M,null,X(f.value,(s,P)=>(g(),$("button",{class:Ue(["mb-3 cursor-pointer w-full py-2 text-start",r.value==s.id?"active":""]),style:{border:"none",display:"block"},key:P,onClick:q=>n(s.id)},[l(_,{style:{color:"#d48a1b"}}),e[10]||(e[10]=t()),C("span",Pe,O(s.name),1),e[11]||(e[11]=t()),C("span",Ne,O(s.count),1)],10,Ee))),128))]),_:1}),e[31]||(e[31]=t()),l(B,{span:20},{default:o(()=>[l(ie,null,{default:o(()=>[l(ue,{value:k.value,"onUpdate:value":e[0]||(e[0]=s=>k.value=s),style:{width:"200px"}},{default:o(()=>[l(W,{value:""},{default:o(()=>e[13]||(e[13]=[t("请选择")])),_:1}),e[14]||(e[14]=t()),(g(!0),$(M,null,X(f.value,(s,P)=>(g(),R(W,{key:P,value:s.id},{default:o(()=>[t(O(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),e[19]||(e[19]=t()),l(Z,{placeholder:"请输入内容",value:c.value,"onUpdate:value":e[1]||(e[1]=s=>c.value=s),style:{width:"400px"}},null,8,["value"]),e[20]||(e[20]=t()),l(E,{type:"primary",danger:"",onClick:p},{default:o(()=>e[15]||(e[15]=[t("搜索")])),_:1}),e[21]||(e[21]=t()),l(E,{type:"primary",plain:"",onClick:e[2]||(e[2]=s=>c.value="")},{default:o(()=>e[16]||(e[16]=[t("清空")])),_:1}),e[22]||(e[22]=t()),l(Te,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=s=>w.value=s),onSuccess:y,cate_id:F.value,"onUpdate:cate_id":e[5]||(e[5]=s=>F.value=s),folders:f.value},{default:o(()=>[l(E,{onClick:e[3]||(e[3]=s=>w.value=!0)},{default:o(()=>e[17]||(e[17]=[t("上传文件")])),_:1})]),_:1},8,["modelValue","cate_id","folders"]),e[23]||(e[23]=t()),se(l(E,{type:"primary",danger:"",plain:"",onClick:H},{default:o(()=>e[18]||(e[18]=[t("删除")])),_:1},512),[[Fe,v.value.del_ids.length>0]])]),_:1}),e[29]||(e[29]=t()),C("div",Oe,[l(ve,{tip:"Loading...",spinning:z.value},{default:o(()=>[l(fe,{value:v.value.del_ids,"onUpdate:value":e[6]||(e[6]=s=>v.value.del_ids=s),class:"min-h-[700px] mt-2",style:{width:"100%"}},{default:o(()=>[l(Y,{gutter:[32,64]},{default:o(()=>[(g(!0),$(M,null,X(m.value,(s,P)=>(g(),R(B,{span:3,key:P},{default:o(()=>[C("div",je,[s.type==="image"?(g(),R(pe,{key:0,ref_for:!0,ref:"imageRef",height:140,style:{height:"140px","object-fit":"cover"},src:`${J(b)}/uploads/${s.path}`,"preview-src-list":[`${J(b)}/uploads/${s.path}`]},null,8,["src","preview-src-list"])):(g(),R(de,{key:1,onClick:q=>I(s.path),height:"160px",width:"160px",style:{width:"160px",height:"160px","font-size":"160px",color:"#e6a23c"}},null,8,["onClick"])),e[28]||(e[28]=t()),C("div",qe,[C("div",Me,[l(Z,{class:"flex-1",ref_for:!0,ref:"inputRef",value:s.name,"onUpdate:value":q=>s.name=q,type:"text",size:"small",style:{width:"100%",color:"grey"}},null,8,["value","onUpdate:value"]),e[25]||(e[25]=t()),l(E,{size:"small",type:"link",onClick:q=>A(s)},{default:o(()=>e[24]||(e[24]=[t("改名")])),_:2},1032,["onClick"])]),e[27]||(e[27]=t()),C("div",null,[C("label",{class:"text-lg cursor-pointer",for:`f-${s.id}`},"选择",8,Xe),e[26]||(e[26]=t()),l(me,{id:`f-${s.id}`,value:s.id},null,8,["id","value"])])])])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["spinning"])]),e[30]||(e[30]=t()),l(_e,{class:"mt-3",current:u.value.page,"onUpdate:current":e[7]||(e[7]=s=>u.value.page=s),"page-size":u.value.page_size,"onUpdate:pageSize":e[8]||(e[8]=s=>u.value.page_size=s),"page-sizes":[24,48,96],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:u.value.total,onChange:a,"show-total":s=>`共 ${u.value.total} 条`},null,8,["current","page-size","total","show-total"])]),_:1})]),_:1})])}}},He={__name:"FoldCreate",props:{modelValue:Boolean},emits:["update:modelValue","success"],setup(L,{emit:V}){const U=i(),b=async()=>{await j.fileCateController.store(f.value)};i([]);const S=L,u=i(S.modelValue);T(()=>S.modelValue,p=>{u.value=p,console.log("watch",u.value)},{immediate:!0});const m=V,f=i({pid:null,name:"",type:""}),k=async()=>{var p;(p=U.value)==null||p.validateFields().then(async a=>{console.log("res",a),await b(f.value),D.error({content:"成功",key:"success"}),m("success"),m("update:modelValue",!1)}).catch(a=>{console.error(a)}).finally(()=>{})},c=()=>{m("update:modelValue",!1)};return(p,a)=>{const w=oe,F=te,v=K,z=Q,r=ee,n=G,A=N;return g(),$("div",null,[l(A,{visible:u.value,"onUpdate:visible":a[2]||(a[2]=y=>u.value=y),title:"创建文件夹",onClose:c,maskClosable:!1},{footer:o(()=>[l(n,{onClick:c},{default:o(()=>a[13]||(a[13]=[t("取消")])),_:1}),a[15]||(a[15]=t()),l(n,{type:"primary",onClick:k},{default:o(()=>a[14]||(a[14]=[t("创建")])),_:1})]),default:o(()=>[l(r,{model:f.value,"laba-width":"100px",ref_key:"formRef",ref:U},{default:o(()=>[l(F,{label:"文件夹名称",name:"name","has-feedback":"",rules:[{required:!0,message:"请输入名称"}]},{default:o(()=>[l(w,{value:f.value.name,"onUpdate:value":a[0]||(a[0]=y=>f.value.name=y)},null,8,["value"])]),_:1}),a[12]||(a[12]=t()),l(F,{label:"文件类型",name:"type","has-feedback":"",rules:[{required:!0,message:"请选择类型"}]},{default:o(()=>[l(z,{value:f.value.type,"onUpdate:value":a[1]||(a[1]=y=>f.value.type=y)},{default:o(()=>[l(v,{value:""},{default:o(()=>a[3]||(a[3]=[t("请选择")])),_:1}),a[8]||(a[8]=t()),l(v,{value:"image"},{default:o(()=>a[4]||(a[4]=[t("图片")])),_:1}),a[9]||(a[9]=t()),l(v,{value:"video"},{default:o(()=>a[5]||(a[5]=[t("视频")])),_:1}),a[10]||(a[10]=t()),l(v,{value:"audio"},{default:o(()=>a[6]||(a[6]=[t("音频")])),_:1}),a[11]||(a[11]=t()),l(v,{value:"file"},{default:o(()=>a[7]||(a[7]=[t("文件")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"]),a[16]||(a[16]=t())]),_:1},8,["visible"])])}}},Je=ze({__name:"FileManager",setup(L){const V=i([]),U=async()=>{V.value=await j.fileCateController.list()},b=i(null),S=i(!1),u=i(!1),m=async()=>{await U(),b.value.searchBy()},f=()=>{u.value=!0},k=()=>{S.value=!1,u.value=!1};return Se(()=>{m()}),i(!1),(c,p)=>{const a=G,w=we,F=ae,v=le,z=ne,r=Be("auth");return g(),$("div",null,[l(F,null,{default:o(()=>[l(w,null,{default:o(()=>[se((g(),R(a,{type:"primary",onClick:f},{default:o(()=>p[1]||(p[1]=[t("创建文件夹")])),_:1})),[[r,void 0,"netdisk"]])]),_:1})]),_:1}),p[2]||(p[2]=t()),l(z,null,{default:o(()=>[l(v,{span:24},{default:o(()=>[l(Ge,{folders:V.value,onRefresh:m,ref_key:"fileListRef",ref:b},null,8,["folders"])]),_:1})]),_:1}),p[3]||(p[3]=t()),l(He,{modelValue:u.value,"onUpdate:modelValue":p[0]||(p[0]=n=>u.value=n),onSuccess:m,onResetVisible:k},null,8,["modelValue"])])}}}),Ke={};function Qe(L,V){const U=Je;return g(),$("div",null,[l(U)])}const Qt=Le(Ke,[["render",Qe]]);export{Qt as default};
//# sourceMappingURL=index.626fd9c4.1755837291293.js.map
