{"version":3,"file":"apply.152194f4.1753605037589.js","sources":["../../src/components/salaryplan-select/index.vue","../../src/pages/salary/apply.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"flex justify-between items-center\">\r\n      <slot name=\"default\">\r\n        <a-row :gutter=\"[16,16]\">\r\n          <a-col :span=\"6\" v-for=\"(s,ind) in my_salary_plans\" :key=\"ind\">\r\n            <a-badge status=\"success\" :text=\"`${s.plan_name},${s.hourly_rate}/节`\"/>\r\n\r\n          </a-col>\r\n        </a-row>\r\n      </slot>\r\n      <div class=\"w-48\">\r\n        <a-space>\r\n          <a-button type=\"primary\" @click=\"openModal = true\">\r\n            <template #icon>\r\n              <edit-outlined/>\r\n            </template>\r\n          </a-button>\r\n          <a-button type=\"primary\" @click=\"onSubmit\">\r\n            <template #icon>\r\n              <check-outlined/>\r\n            </template>\r\n          </a-button>\r\n        </a-space>\r\n      </div>\r\n    </div>\r\n    <div class=\"mt-1\">\r\n      <a-modal v-model:visible=\"openModal\" width=\"600px\" title=\"选择方案\" centered @ok=\"()=>openModal=false\">\r\n        <vxe-table\r\n            :row-config=\"{keyField:'value'}\"\r\n            size=\"small\"\r\n            border\r\n            ref=\"tableRef\"\r\n            :data=\"dataSource\"\r\n            :checkbox-config=\"{checkRowKeys: checkedKeys}\"\r\n            @checkbox-all=\"selectAllChangeEvent\"\r\n            @checkbox-change=\"selectChangeEvent\">\r\n          <vxe-column type=\"checkbox\"></vxe-column>\r\n          <vxe-column field=\"value\" title=\"序号\"></vxe-column>\r\n          <vxe-column field=\"label\" title=\"方案\" :width=\"400\"></vxe-column>\r\n        </vxe-table>\r\n      </a-modal>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport Api from \"@/api\"\r\n\r\nconst tableRef = ref(null)\r\nconst selectAllChangeEvent = () => {\r\n}\r\n\r\n\r\nconst props = defineProps({\r\n  salary_plans: {\r\n    type: Array as PropType<Plan[]>,\r\n    default: () => []\r\n  },\r\n  id: {\r\n    type: Number,\r\n    default: 0\r\n  },\r\n});\r\n\r\n\r\nconst checkedKeys = ref([])\r\n\r\nconst my_salary_plans = ref(props.salary_plans);\r\n\r\nconst selectChangeEvent = (row) => {\r\n  const $table = tableRef.value;\r\n  const records = $table.getCheckboxRecords()\r\n  myOptions.value = records\r\n  // emit(\"update:salary_plans\", records);\r\n}\r\nconst myOptions = ref([])\r\nconst dataSource = ref([]);\r\n\r\n\r\ninterface Plan {\r\n  id: number;\r\n  plan_name: string;\r\n}\r\n\r\nconst fillData = async () => {\r\n  dataSource.value = await Api.salaryPlanController.option();\r\n  /*处理回显*/\r\n  checkedKeys.value = props.salary_plans.map(item => item.id)\r\n};\r\nconst openModal = ref(false);\r\n\r\n/*监听openModal的执行，当为true时才开启网络加载数据*/\r\nwatch(openModal, (val) => {\r\n  if (val) {\r\n    fillData()\r\n  }\r\n})\r\n\r\nconst emit = defineEmits(['freshTable'])\r\nconst onSubmit = async () => {\r\n  await Api.salaryPlanController.syncUser({\r\n    id: props.id,\r\n    opts: myOptions.value\r\n  })\r\n  /*刷新父表格*/\r\n  console.log(\"刷新父表格1\")\r\n  emit('freshTable')\r\n}\r\n</script>\r\n\r\n<style scoped></style>","<script setup lang=\"ts\">\r\nimport useCoach from \"./useCoach\";\r\nimport Api from \"@/api\";\r\nimport {VxeGridListeners} from \"vxe-table\";\r\n\r\nconst serveApiUrl = import.meta.env.VITE_API_URL;\r\n\r\nconst {gridOptions} = useCoach()\r\n// TABLE\r\nconst xGrid = ref()\r\n\r\ninterface RowVO {\r\n}\r\n\r\nconst gridEvent: VxeGridListeners<RowVO> = {\r\n  proxyQuery() {\r\n    console.log('数据代理查询事件')\r\n    const grid = xGrid.value\r\n    // 获取表格中的数据\r\n    const data = grid.getTableData().fullData\r\n  },\r\n  proxyDelete() {\r\n    console.log('数据代理删除事件')\r\n  },\r\n  proxySave() {\r\n    console.log('数据代理保存事件')\r\n  }\r\n}\r\n/*\r\n* 设置权限 */\r\nconst open = ref(false)\r\nconst role_id = ref(null)\r\nconst setPer = (row) => {\r\n  open.value = true;\r\n  role_id.value = row.id\r\n}\r\nconst onClose = () => {\r\n  open.value = false;\r\n}\r\nconst tableRef = ref()\r\nconst onSubmit = async () => {\r\n  // console.log('submit!')\r\n  // 获取表单中的数据\r\n  const data = tableRef.value.getCheckboxRecords()\r\n  console.log(data)\r\n  //构造数据\r\n  let auth_items = data.map(item => {\r\n    return {\r\n      permission: item.permission,\r\n      auth_api: item.api_auth\r\n    }\r\n  })\r\n  let req = Object.assign({}, {\r\n    auth_items: auth_items\r\n  })\r\n  console.log(req)\r\n  await Api.roleController.syncPermissions({id: role_id.value}, req)\r\n}\r\nconst tableData = ref([]);\r\nconst getMenu = async () => {\r\n  // @ts-ignore\r\n  tableData.value = await Api.menuController.option()\r\n}\r\n\r\n\r\ngetMenu()\r\n\r\nconst freshTable = () => {\r\n  console.log('刷新表格2')\r\n  xGrid.value.commitProxy('query');\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <vxe-grid ref='xGrid' v-bind=\"gridOptions\" v-on=\"gridEvent\">\r\n      <template #head_shot=\"{row}\">\r\n        <a-avatar size=\"large\" :src=\"`${serveApiUrl}${row.head_shot}`\" />\r\n      </template>\r\n      <template #plans=\"{ row }\">\r\n        <div>\r\n          <SalaryplanSelect @freshTable=\"freshTable\" v-model:id=\"row.id\" v-model:salary_plans=\"row.salary_plans\"/>\r\n        </div>\r\n      </template>\r\n    </vxe-grid>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"less\">\r\n.expand-wrapper {\r\n  padding: 20px;\r\n}\r\n</style>"],"names":["tableRef","ref","selectAllChangeEvent","props","__props","checkedKeys","my_salary_plans","selectChangeEvent","row","records","myOptions","dataSource","fillData","Api","item","openModal","watch","val","emit","__emit","onSubmit","serveApiUrl","gridOptions","useCoach","xGrid","gridEvent","tableData","freshTable"],"mappings":"+7FAiDA,MAAAA,EAAAC,EAAA,IAAA,EACAC,EAAA,IAAA,CAAmC,EAInCC,EAAAC,EAYAC,EAAAJ,EAAA,CAAA,CAAA,EAEAK,EAAAL,EAAAE,EAAA,YAAA,EAEAI,EAAAC,GAAA,CAEE,MAAAC,EADAT,EAAA,MACA,qBACAU,EAAA,MAAAD,CAAkB,EAGpBC,EAAAT,EAAA,CAAA,CAAA,EACAU,EAAAV,EAAA,CAAA,CAAA,EAQAW,EAAA,SAAA,CACED,EAAA,MAAA,MAAAE,EAAA,qBAAA,OAAA,EAEAR,EAAA,MAAAF,EAAA,aAAA,IAAAW,GAAAA,EAAA,EAAA,CAA0D,EAE5DC,EAAAd,EAAA,EAAA,EAGAe,EAAAD,EAAAE,GAAA,CACEA,GACEL,GACF,CAAA,EAGF,MAAAM,EAAAC,EACAC,EAAA,SAAA,CACE,MAAAP,EAAA,qBAAA,SAAA,CAAwC,GAAAV,EAAA,GAC5B,KAAAO,EAAA,KACM,CAAA,EAGlB,QAAA,IAAA,QAAA,EACAQ,EAAA,YAAA,CAAiB,mtCCtGnB,MAAAG,EAAA,sBAEA,CAAA,YAAAC,GAAAC,KAEAC,EAAAvB,IAKAwB,EAAA,CAA2C,YAAA,CAEvC,QAAA,IAAA,UAAA,EACAD,EAAA,MAEA,aAAA,EAAA,QAAiC,EACnC,aAAA,CAEE,QAAA,IAAA,UAAA,CAAsB,EACxB,WAAA,CAEE,QAAA,IAAA,UAAA,CAAsB,CACxB,EAIFvB,EAAA,EAAA,EACAA,EAAA,IAAA,EAQAA,EAAA,EAmBA,MAAAyB,EAAAzB,EAAA,CAAA,CAAA,GACA,SAAA,CAEEyB,EAAA,MAAA,MAAAb,EAAA,eAAA,OAAA,CAAkD,KAMpD,MAAAc,EAAA,IAAA,CACE,QAAA,IAAA,OAAA,EACAH,EAAA,MAAA,YAAA,OAAA,CAA+B"}