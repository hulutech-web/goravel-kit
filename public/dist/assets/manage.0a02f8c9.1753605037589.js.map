{"version":3,"file":"manage.0a02f8c9.1753605037589.js","sources":["../../src/pages/team/manage.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport Api from \"@/api\";\r\nimport {VxeToolbarEvents, VxeToolbarPropTypes} from \"vxe-pc-ui/types/components/toolbar\";\r\nimport {VxeUI} from \"vxe-pc-ui\";\r\n\r\nconst route = useRoute();\r\nconst id = ref(route.params.id);\r\nconst serveApiUrl = import.meta.env.VITE_API_URL;\r\nconst teamForm = ref({\r\n  name: \"\",\r\n  captain_id: \"\",\r\n  sport_type: \"\",\r\n  establishment_date: \"\",\r\n  members_count: \"\",\r\n  team_level: \"\",\r\n  logo: \"\",\r\n  motto: \"\",\r\n  contact_phone: \"\",\r\n  achievement: \"\",\r\n  images: \"\",\r\n  members: []\r\n})\r\n\r\nconst getTeam = async () => {\r\n  teamForm.value = await Api.teamController.show({id: id.value})\r\n  if (teamForm.value.members == null) {\r\n    teamForm.value.members = []\r\n  }\r\n};\r\n\r\nconst toolbarButtons = ref<VxeToolbarPropTypes.Buttons>([\r\n  {name: '新增', code: 'add', status: 'primary'},\r\n  {name: '删除', code: 'del', status: 'error'},\r\n  {name: '保存', code: 'save', status: 'success'}\r\n])\r\nconst buttonClickEvent: VxeToolbarEvents.ButtonClick = async ({code, $event}) => {\r\n  switch (code) {\r\n    case \"add\":\r\n      teamForm.value.members.push({\r\n        user_id: 0,\r\n        username: \"\"\r\n      })\r\n      break;\r\n    case \"del\":\r\n      const $table = tableRef.value;\r\n      const selectRecords = $table.getCheckboxRecords();\r\n      if (selectRecords.length > 0) {\r\n        console.log(selectRecords)\r\n        let records = selectRecords.map(item => {\r\n          return {\r\n            id: item.id,\r\n            username:item.username,\r\n          }\r\n        })\r\n        /*@袁浩 这里有问题，操作是删除*/\r\n        $table.removeCheckboxRow()\r\n        await Api.teamController.syncUser({id: id.value}, {members: records})\r\n        /*从新刷新数据*/\r\n        await getTeam()\r\n      } else {\r\n        VxeUI.modal.message({\r\n          content: '未选择数据',\r\n          status: 'info'\r\n        })\r\n      }\r\n      /*找到被点击的行，并删除*/\r\n      teamForm.value.members = teamForm.value.members.filter(i => i.id !== $event.target.dataset.id)\r\n      break;\r\n    case \"save\":\r\n      await Api.teamController.syncUser({id: id.value}, {members: teamForm.value.members})\r\n      // tableRef.value.commitProxy('query')\r\n      break;\r\n  }\r\n}\r\n\r\ngetTeam()\r\nconst tableRef = ref(null)\r\nconst toolbarRef = ref(null)\r\n\r\n\r\nonMounted(() => {\r\n  const $table = tableRef.value\r\n  const $toolbar = toolbarRef.value\r\n  if ($table && $toolbar) {\r\n    $table.connect($toolbar)\r\n  }\r\n})\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <a-divider>队伍</a-divider>\r\n    <a-descriptions :size=\"'small'\" bordered layout=\"vertical\" :column=\"6\">\r\n      <a-descriptions-item label=\"队名\">{{ teamForm.name }}</a-descriptions-item>\r\n      <a-descriptions-item label=\"运动类型\">{{ teamForm.sport_type }}\r\n      </a-descriptions-item>\r\n      <a-descriptions-item label=\"成立时间\">{{\r\n          teamForm.establishment_date\r\n        }}\r\n      </a-descriptions-item>\r\n      <a-descriptions-item label=\"成员数\">{{ teamForm.members_count }}</a-descriptions-item>\r\n      <a-descriptions-item label=\"竞技水平\">{{ teamForm.team_level }}</a-descriptions-item>\r\n      <a-descriptions-item label=\"团队宣言\">{{ teamForm.motto }}</a-descriptions-item>\r\n      <a-descriptions-item label=\"团队成就\">{{ teamForm.achievement }}</a-descriptions-item>\r\n      <a-descriptions-item label=\"联系电话\">{{ teamForm.contact_phone }}</a-descriptions-item>\r\n      <a-descriptions-item label=\"logo\" :span=\"2\" v-if=\"teamForm.logo\">\r\n        <vxe-image :src=\"`${serveApiUrl}/uploads/${teamForm.logo}`\" width=\"48\" height=\"48\"></vxe-image>\r\n      </a-descriptions-item>\r\n      <a-descriptions-item label=\"创建时间\">{{ teamForm.created_at }}</a-descriptions-item>\r\n    </a-descriptions>\r\n    <a-divider>成员</a-divider>\r\n    <vxe-toolbar ref=\"toolbarRef\" :buttons=\"toolbarButtons\" @button-click=\"buttonClickEvent\"></vxe-toolbar>\r\n    <vxe-table\r\n        size=\"small\"\r\n        ref=\"tableRef\"\r\n        :keepSource=\"true\"\r\n        border\r\n        :cell-config=\"{height:64}\"\r\n        show-overflow\r\n        :edit-config=\"{mode: 'row', trigger: 'click', showStatus: true}\"\r\n        :data=\"teamForm.members\">\r\n\r\n      <vxe-column type=\"checkbox\" width=\"60\"></vxe-column>\r\n      <vxe-column field=\"id\" title=\"用户\">\r\n        <template #default=\"{row}\">\r\n          <UserSelect v-model:id=\"row.id\" v-model:username=\"row.username\"/>\r\n        </template>\r\n      </vxe-column>\r\n      <vxe-column field=\"avatar\" title=\"头像\">\r\n        <template #default=\"{row}\">\r\n          <vxe-image :src=\"`${serveApiUrl}/uploads${row.avatar}`\" width=\"48\" height=\"48\"></vxe-image>\r\n        </template>\r\n      </vxe-column>\r\n      <vxe-column field=\"action\" title=\"操作\">\r\n        <template #action=\"{row}\">\r\n          <a-button type=\"primary\" danger size=\"small\">删除</a-button>\r\n        </template>\r\n      </vxe-column>\r\n    </vxe-table>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"less\">\r\n\r\n</style>"],"names":["route","useRoute","id","ref","serveApiUrl","teamForm","getTeam","Api","toolbarButtons","buttonClickEvent","code","$event","$table","tableRef","selectRecords","records","item","VxeUI","toolbarRef","onMounted","$toolbar"],"mappings":"8vFAKA,MAAAA,EAAAC,IACAC,EAAAC,EAAAH,EAAA,OAAA,EAAA,EACAI,EAAA,sBACAC,EAAAF,EAAA,CAAqB,KAAA,GACb,WAAA,GACM,WAAA,GACA,mBAAA,GACQ,cAAA,GACL,WAAA,GACH,KAAA,GACN,MAAA,GACC,cAAA,GACQ,YAAA,GACF,OAAA,GACL,QAAA,CAAA,CACE,CAAA,EAGZG,EAAA,SAAA,CACED,EAAA,MAAA,MAAAE,EAAA,eAAA,KAAA,CAAA,GAAAL,EAAA,KAAA,CAAA,EACAG,EAAA,MAAA,SAAA,OACEA,EAAA,MAAA,QAAA,GACF,EAGFG,EAAAL,EAAA,CAAwD,CAAA,KAAA,KAAA,KAAA,MAAA,OAAA,SAAA,EACX,CAAA,KAAA,KAAA,KAAA,MAAA,OAAA,OAAA,EACF,CAAA,KAAA,KAAA,KAAA,OAAA,OAAA,SAAA,CACG,CAAA,EAE9CM,EAAA,MAAA,CAAA,KAAAC,EAAA,OAAAC,CAAA,IAAA,CACE,OAAAD,EAAA,CAAc,IAAA,MAEVL,EAAA,MAAA,QAAA,KAAA,CAA4B,QAAA,EACjB,SAAA,EACC,CAAA,EAEZ,MAAA,IAAA,MAEA,MAAAO,EAAAC,EAAA,MACAC,EAAAF,EAAA,qBACA,GAAAE,EAAA,OAAA,EAAA,CACE,QAAA,IAAAA,CAAA,EACA,IAAAC,EAAAD,EAAA,IAAAE,IACE,CAAO,GAAAA,EAAA,GACI,SAAAA,EAAA,QACK,EAChB,EAGFJ,EAAA,kBAAA,EACA,MAAAL,EAAA,eAAA,SAAA,CAAA,GAAAL,EAAA,OAAA,CAAA,QAAAa,CAAA,CAAA,EAEA,MAAAT,EAAA,CAAc,MAEdW,EAAA,MAAA,QAAA,CAAoB,QAAA,QACT,OAAA,MACD,CAAA,EAIZZ,EAAA,MAAA,QAAAA,EAAA,MAAA,QAAA,OAAA,GAAA,EAAA,KAAAM,EAAA,OAAA,QAAA,EAAA,EACA,MAAA,IAAA,OAEA,MAAAJ,EAAA,eAAA,SAAA,CAAA,GAAAL,EAAA,KAAA,EAAA,CAAA,QAAAG,EAAA,MAAA,OAAA,CAAA,EAEA,KAAA,CACJ,EAGFC,IACA,MAAAO,EAAAV,EAAA,IAAA,EACAe,EAAAf,EAAA,IAAA,EAGA,OAAAgB,EAAA,IAAA,CACE,MAAAP,EAAAC,EAAA,MACAO,EAAAF,EAAA,MACAN,GAAAQ,GACER,EAAA,QAAAQ,CAAA,CACF,CAAA"}